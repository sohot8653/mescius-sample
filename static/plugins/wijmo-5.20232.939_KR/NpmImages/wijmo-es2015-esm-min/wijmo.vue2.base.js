/*!
    *
    * Wijmo Library 5.20232.939
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

import{isArray,Control,isUndefined,isFunction,Event}from"wijmo/wijmo";import*as VueModule from"vue";var Vue=VueModule.default||VueModule;export var VueApi=Vue.version&&"3"===Vue.version[0]?{isV3Plus:!0,modelValueProp:"modelValue",extend:t=>t,h:Vue.h,render:Vue.render}:Vue;var WjVueBaseDefinition={beforeCreate:function(){let t=this.$options[WjComponentBehavior._behClassProp];t&&(this[WjComponentBehavior._behProp]=t._attach(this))},mounted:function(){this[WjComponentBehavior._behProp].lhMounted()}};WjVueBaseDefinition[VueApi.isV3Plus?"unmounted":"destroyed"]=function(){this[WjComponentBehavior._behProp].lhDestroyed()};var WjVueBase=VueApi.extend(WjVueBaseDefinition);export class WjComponentBehavior{constructor(t){this._isMounted=!1;this._mountedCBs=[];this.component=t}static _attach(t){return new this(t)}static register(){let t={data:this.data,extends:WjVueBase,render:this.render,props:this._getProps(),model:this._getModel(),[WjComponentBehavior._behClassProp]:this};return VueApi.isV3Plus?Object.assign({},t,{emits:this._getEmits()}):VueApi.component(this.tag,t)}lhMounted(){if(this._isChild()){let t=this.component.$parent;if(t){this.parent=t[WjComponentBehavior._behProp];this.parent._mountedCB(()=>{this._prepareControl();this._initParent()})}}else this._prepareControl()}lhDestroyed(){this._siblingInsertedMO&&this._siblingInsertedMO.disconnect();let t=this.control;if(t)if(this._isChild()){let e=this._getParentProp();if(e){let i=this.parent.control[e];if(isArray(i)){let e=i.indexOf(t);e>-1&&i.splice(e,1)}}}else t instanceof Control&&t.dispose()}static _getProps(){let t=[];this.props&&(t=this.props);this.events&&(t=t.concat(this.events));this.changeEvents&&(t=t.concat(Object.keys(this.changeEvents)));VueApi.isV3Plus&&this.modelProp&&t.push(VueApi.modelValueProp);return t}static _getModel(){let t=this.modelProp;return t?{prop:t,event:"update:"+t}:null}static _getEmits(){if(!this.changeEvents)return[];let t=[];Object.keys(this.changeEvents).forEach(e=>this.changeEvents[e].forEach(e=>{t.indexOf(e)<0&&t.push(e)}));this.modelProp&&t.push(VueApi.modelValueProp);return t.map(t=>`update:${t}`)}_createControl(){let t=this._isChild()?this._isParentInCtor()?this.parent.control:void 0:this._getElement();return new(this.constructor._getControlType())(t)}_initParent(){let t=this._getParentProp();if(t){let e=this.parent.control,i=e[t];if(isArray(i)){let t=this._getSiblingIndex();(t<0||t>=i.length)&&(t=i.length);i.splice(t,0,this.control);const e=this._getElement();this._siblingInsertedMO=new MutationObserver(this._siblingInserted.bind(this));this._siblingInsertedMO.observe(e,{childList:!0})}else e[t]=this.control}}_updateControl(t,e){this.control[t]=e}_prepareControl(){let t=this.control=this._createControl(),e=this._getElement(),i=this.constructor;this.component.control=t;if(!this._siblingId){null==i.siblingId&&(i.siblingId=++i._siblingDirId+"");this._siblingId=i.siblingId}e.setAttribute(i._typeSiblingIdAttr,this._siblingId);this._isMounted=!0;let n=this._mountedCBs;this._mountedCBs=[];for(let t of n)t();_initialize(this)}_isChild(){let t=this.constructor;return null!=t.parentProp||null!=t.parentInCtor}_isParentInCtor(){return!0===this.constructor.parentInCtor}_getParentProp(){return(VueApi.isV3Plus?this.component.$props:this.component.$options.propsData).wjProperty||this.constructor.parentProp}_getSiblingIndex(){var t=this._getElement(),e=t.parentElement;if(!e||!e.getAttribute(WjComponentBehavior._typeSiblingIdAttr))return-1;for(var i=e.childNodes,n=-1,o=this._siblingId,s=0;s<i.length;s++){var r=i[s];if(1==r.nodeType&&r.getAttribute(WjComponentBehavior._typeSiblingIdAttr)==o){++n;if(r===t)return n}}return-1}_siblingInserted(t){for(let e of t)if("childList"===e.type&&e.addedNodes.length>0){if(Array.from(e.addedNodes).some(t=>t===this._getElement())){const t=this._getSiblingIndex(),e=this.control,i=this.parent.control[this._getParentProp()],n=i.indexOf(e);if(t>=0&&n>=0&&t!==n){i.splice(n,1);const o=Math.min(t,i.length);i.splice(o,0,e)}}}}_getElement(){return this.component.$el}static _getControlType(){return this.classCtor()}_mountedCB(t){this._isMounted?t():this._mountedCBs.push(t)}}WjComponentBehavior.render=function(t){const e=this.$slots.default;return VueApi.isV3Plus?VueApi.h("div",{},[e&&e()]):t("div",[e])};WjComponentBehavior._typeSiblingIdAttr="_wjSiblingId";WjComponentBehavior._behClassProp="_wjBehCl";WjComponentBehavior._behProp="__wjBeh";WjComponentBehavior._propIdxMapProp="__propInitIdx";WjComponentBehavior._siblingDirId=0;export function _initialize(t){let e=t.component,i=t.control,n=t.constructor,o=n[WjComponentBehavior._propIdxMapProp];if(!o){o=n[WjComponentBehavior._propIdxMapProp]={};let t=n.props;if(t)for(let e=0;e<t.length;e++)o[t[e]]=e}var s=[],r=[],p=[],l=n.changeEvents||{};const h=VueApi.isV3Plus?e.$props:e.$options.propsData,a=n.modelProp;for(var u in h)null!=o[u]?s.push(u):l[u]?p.push(u):r.push(u);VueApi.isV3Plus&&a&&h.hasOwnProperty(VueApi.modelValueProp)&&!h.hasOwnProperty(a)&&s.push(a);s.sort((t,e)=>o[t]-o[e]);e[WjComponentBehavior._behProp].constructor.extraProps;function _subscribeEvents(t){t.forEach(t=>{"initialized"!==t&&t.indexOf(".")<0&&isFunction(e[t])&&i[t].addHandler(e[t],i)})}_subscribeEvents(r);s.forEach(t=>{if(VueApi.isV3Plus){const i=VueApi.modelValueProp;if(isUndefined(e[t])){if(t===a&&!isUndefined(e[i])){e[WjComponentBehavior._behProp]._updateControl(t,e[i]);e.$watch(i,_updateControl.bind({cmp:e,prop:a}))}}else e[WjComponentBehavior._behProp]._updateControl(t,e[t]);e.$watch(t,_updateControl.bind({cmp:e,prop:t}))}else{isUndefined(e[t])||e[WjComponentBehavior._behProp]._updateControl(t,e[t]);e.$watch(t,_updateControl.bind({cmp:e,prop:t}))}});function _updateControl(t){this.cmp[WjComponentBehavior._behProp]._updateControl(this.prop,t)}!function _updateStyleProp(){var t=e.$el,n={};if("style"in i&&t.style.cssText.length){t.style.cssText.split(";").forEach(t=>{var e=t.split(":");2==e.length&&(n[e[0].trim()]=e[1].trim())});i.style=n}}();_subscribeEvents(p);if(l){let t=Object.keys(l);for(let n of t)_subscribeChangeEvents(n,l[n],i,e)}function _subscribeChangeEvents(t,e,i,n){if(e){let o=i[t];o instanceof Event&&o.addHandler((t,i)=>{for(let i of e){n.$emit("update:"+i,t[i]);if(VueApi.isV3Plus&&i===a&&isUndefined(n[i])){const e=VueApi.modelValueProp;isUndefined(n[e])||n.$emit(`update:${e}`,t[i])}}},i)}}isFunction(e.initialized)&&e.initialized(i);return i}