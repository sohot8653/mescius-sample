/*!
    *
    * Wijmo Library 5.20232.939
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

var __awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function fulfilled(t){try{step(n.next(t))}catch(t){o(t)}}function rejected(t){try{step(n.throw(t))}catch(t){o(t)}}function step(t){t.done?s(t.value):new i((function(e){e(t.value)})).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())}))};import{Control,Event,isArray,addClass,removeClass,setCss,isFunction,isPrimitive,isObject,DateTime,isUndefined,isSafari}from"@grapecity/wijmo";import*as ReactDOM from"react-dom";import*as React from"react";const flushSyncPolyfill=t=>{t()},createRootPolyfill=()=>{throw"Wijmo: React dependencies not loaded properly"},ReactDomPolyfill={flushSync:flushSyncPolyfill,createRoot:createRootPolyfill};let reactDomClient=ReactDOM||ReactDomPolyfill,flushSync=reactDomClient.flushSync;function lazyImportDomClient(){return __awaiter(this,void 0,void 0,(function*(){try{const t=require("react-dom/client");reactDomClient=t||ReactDOM||ReactDomPolyfill;flushSync=t.flushSync||flushSync}catch(t){reactDomClient=ReactDOM||ReactDomPolyfill}}))}export class ComponentBase extends React.Component{constructor(t,e,i){super(t);this._objPropHash={};this._isMounted=!1;this._mountedCBs=[];this._hostRef=t=>this._hostRefValue=t;this._beforeRender=new Event;this._afterRender=new Event;this._beforeWillUnmount=new Event;this._afterWillUnmount=new Event;this._beforeDidUpdate=new Event;this._afterDidUpdate=new Event;if(this._isMounted&&!this._isChild()){clearTimeout(this.timer);return this}if(!ComponentBase._reactMajorVersion){const t=parseInt(React.version);ComponentBase._reactMajorVersion=t;t>=18&&lazyImportDomClient()}this.props=t;this.controlType=e;for(let t of i&&i.objectProps||[])this._objPropHash[t]=!0}render(){this._onBeforeRender();const t=this._renderImpl();this._onAfterRender();this.renderResult=t;if(this._isMounted&&!this._isChild()){clearTimeout(this.timer);return this.renderResult}return t}componentDidMount(){if(this._isMounted){clearTimeout(this.timer);return this.control}if(this._isChild()){let t=this.props[ComponentBase._propsParent];t&&t._mountedCB(()=>{this._setParent(t)})}else this._prepareControl();this._isMounted=!0;return this.control}static selectiveDomRender(t,e,i=!0){if(ComponentBase._reactMajorVersion<18)ReactDOM.render(t,e);else{const i=ComponentBase.elemRootMap.findIndex(t=>t.host===e);let n;if(-1===i){n=reactDomClient.createRoot(e);ComponentBase.elemRootMap.push({host:e,root:n})}else n=ComponentBase.elemRootMap[i].root;flushSync(()=>{n.render(t)})}return e}static selectiveDomUnmount(t){if(ComponentBase._reactMajorVersion<18)ReactDOM.unmountComponentAtNode(t);else{const e=ComponentBase.elemRootMap.findIndex(e=>e.host===t);if(-1!==e){const t=ComponentBase.elemRootMap[e].root;flushSync(()=>{t.unmount();ComponentBase.elemRootMap.splice(e,1)})}}}componentWillUnmount(){this._onBeforeWillUnmount();this._siblingInsertedMO&&this._siblingInsertedMO.disconnect();let t=this.control;if(t)if(this._isChild()){let e=this._getParentProp();if(e){let i=this.parent.control[e];if(isArray(i)){let e=i.indexOf(t);if(e>-1){const t=i[e];"Sheet"===t.constructor.name&&t._isEmptyGrid||i.splice(e,1)}}}}else t instanceof Control&&(this.timer=setTimeout(()=>{if(t.hostElement){t._orgOuter=null;t.dispose()}},5));this._onAfterWillUnmount()}shouldComponentUpdate(t){return!0}componentDidUpdate(t){this._onBeforeDidUpdate();var e=this.control;this._copy(e,this.props,t);this._onAfterDidUpdate()}_mountedCB(t){this._isMounted&&!this._isChild()?t():this._isMounted||this._mountedCBs.push(t);setTimeout(()=>{this._mountedCBs.includes(t)||this._mountedCBs.push(t)},isSafari?200:10)}_renderImpl(){let t={};t[ComponentBase._propsParent]=this;let e=React.Children.map(this.props.children,e=>e&&React.cloneElement(e,t));const i={ref:this._hostRef};this._isChild()&&(i.style={display:"none"});return React.createElement("div",i,e)}_onBeforeRender(t){this._beforeRender.raise(this,t)}_onAfterRender(t){this._afterRender.raise(this,t)}_onBeforeWillUnmount(t){this._beforeWillUnmount.raise(this,t)}_onAfterWillUnmount(t){this._afterWillUnmount.raise(this,t)}_onBeforeDidUpdate(t){this._beforeDidUpdate.raise(this,t)}_onAfterDidUpdate(t){this._afterDidUpdate.raise(this,t)}_createControl(){const t=this._isChild()?this._isParentInCtor()?this.parent.control:void 0:this._getElement();t instanceof Element&&this.props.id&&t.setAttribute("id",this.props.id);const e=new this.controlType(t);e.workingAs="React";return e}_prepareControl(){this._renderImpl();let t=this._getElement(),e=this.props;t&&!this._isChild()&&ComponentBase._copyAttrs(t,e,Control._rxInputAtts);let i=this.control=this._createControl(),n=i instanceof Control,s=ComponentBase;t=this._getElement();if(!this._siblingId){null==this.constructor[s._typeSiblingIdProp]&&(this.constructor[s._typeSiblingIdProp]=++s._siblingDirId+"");this._siblingId=this.constructor[s._typeSiblingIdProp]}if(t){t.setAttribute(s._typeSiblingIdProp,this._siblingId);var o={};for(var r in e){let n=e[r];this._ignoreProp(r)||isUndefined(n)||(r in i?o[r]=n:this._setHostAttribute(t,r,n))}n?i.initialize(o):this._copy(i,o,null,!0);setTimeout(()=>{let t=this._mountedCBs;for(let e in t){t[e]();delete t[e]}isFunction(e.initialized)&&e.initialized(i);this._isMounted=!0},isSafari?201:100)}}_initParent(){if(!this._getElement())return;let t=this._getParentProp();if(t){let e=this.parent.control,i=e[t];if(isArray(i)){let t=this._getSiblingIndex();(t<0||t>=i.length)&&(t=i.length);i.splice(t,0,this.control);const e=this._getElement();this._siblingInsertedMO=new MutationObserver(this._siblingInserted.bind(this));this._siblingInsertedMO.observe(e,{childList:!0})}else e[t]=this.control}}_setParent(t){if(t!==this.parent){if(this.parent)throw"Wijmo child component is already attached to a different parent.";this.parent=t;this._prepareControl();this._initParent()}}_isChild(){return null!=this._parentProp||null!=this._parentInCtor}_isParentInCtor(){return!0===this._parentInCtor}_getParentProp(){return this.props.wjProperty||this._parentProp}_getSiblingIndex(){var t=this._getElement(),e=t.parentElement;if(!e)return-1;for(var i=e.childNodes,n=-1,s=this._siblingId,o=0;o<i.length;o++){var r=i[o];if(1==r.nodeType&&r.getAttribute(ComponentBase._typeSiblingIdProp)==s){++n;if(r===t)return n}}return-1}_siblingInserted(t){for(let e of t)if("childList"===e.type&&e.addedNodes.length>0){if(Array.from(e.addedNodes).some(t=>t===this._getElement())){const t=this._getSiblingIndex(),e=this.control,i=this.parent.control[this._getParentProp()],n=i.indexOf(e);if(t>=0&&n>=0&&t!==n){i.splice(n,1);const s=Math.min(t,i.length);i.splice(s,0,e)}}}}_copy(t,e,i,n=!1){if(!t||!e)return;let s,o=t===this.control;for(var r in e)if(!this._ignoreProp(r)||!o){var l=e[r];if(r in t){if(this._isEvent(t,r))n&&isFunction(l)&&t[r].addHandler(l);else if(!i||!this._sameValue(i[r],l))if(null==l)t[r]=l;else if(isPrimitive(l)||isFunction(l)||this._objPropHash[r]&&t===(s||(s=this.control)))t[r]=l;else if(isArray(l)&&isArray(t[r])){let e=t[r],i=l;if(i.length==e.length)for(var a=0;a<i.length;a++){if(i[a]!==e[a])return!1;this._copy(e[a],i[a])}}else isObject(l)&&this._copy(t[r],e[r])}else this._setHostAttribute(t.hostElement,r,e[r])}}_setHostAttribute(t,e,i){if(t)switch(e){case"className":const n=this._appliedClassName;if(n!==i){removeClass(t,n);addClass(t,i);this._appliedClassName=i}break;case"style":setCss(t,i);break;default:null!=t[e]?t[e]=i:"string"==typeof i&&"$"!==e[0]&&t.setAttribute(e,i)}}_sameValue(t,e){return t==e||DateTime.equals(t,e)}_isEvent(t,e){let i=t&&t[e];return null!=i&&i instanceof Event}_getElement(){return this._hostRefValue}_ignoreProp(t){return"children"===t}static _copyAttrs(t,e,i){if(t)for(let n in e)n.match(i)&&t.setAttribute(n,e[n])}static isInStrictMode(t){return!!(t.hasOwnProperty("_reactInternalFiber")&&1&t._reactInternalFiber.mode)}}ComponentBase._propsParent="$parent";ComponentBase._typeSiblingIdProp="_wjSiblingIdProp";ComponentBase._siblingDirId=0;ComponentBase.elemRootMap=[];