/*!
 * 
 * SpreadJS Library 17.0.2
 *
 * Copyright(c) MESCIUS inc.  All rights reserved.
 *
 * Licensed under the SpreadJS Commercial License.
 * us.sales@mescius.com
 * https://developer.mescius.com/spreadjs
 *
 */
var GC;!function(){"use strict";var i,e,n;function r(n){var t,t,t=e[n];return void 0!==t||(t=e[n]={exports:{}},i[n].call(t.exports,t,t.exports,r)),t.exports}i={"./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges-event.js":function(n,t,i){var T,R,M,t,j,i,m,w,x,A;function y(n,t,i,e,r){var t,n,o,u,a,s,f,t=t.Ut,n=n.Qvt(),o=T.SheetArea.viewport;return n===T.SheetArea.colHeader&&r===T.SheetArea.colHeader?i<(u=t.getFreeAreaRowCount(T.SheetArea.colHeader))&&(o=T.SheetArea.colHeader):n===T.SheetArea.rowHeader&&r===T.SheetArea.rowHeader&&e<(s=t.getFreeAreaColumnCount(T.SheetArea.rowHeader))&&(o=T.SheetArea.rowHeader),o}function D(n,t,i,e,r,o,u,a){var s=n.xA(t,i,t,i,u,a),s=(0,T.Ec)(s.row,s.col,1,1);return s=o&&0<=e?n.xA(t,i,e,r,u,a):s}Object.defineProperty(t,"__esModule",{value:!0}),T=i("Core"),R=i("CalcEngine"),M=i("./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges.js"),t=i("Common"),j=t.Common.lt.ht,i=T.GC$.extend,m=null,w=void 0,x=Math.max,A=Math.min,i(T.nk.prototype,{Kvt:function(n){var t,i,e,r,r,o,u,a,s,f,c,l,g,h,v,d,I,p,m,x,A,C,b,o,s,u,f,i,c,r,o,s,t=this,i=t.Mf,e=t.Dde(),r=i.parent,r=r&&0!==r.options.pivotAreaReference;e&&(t.jde(),o=i.frozenRowCount(),u=i.frozenColumnCount(),(a=e.XD)&&t.Lvt||(t.Lvt={anchorRow:-1,anchorCol:-1,leadingRow:-1,leadingCol:-1}),s=i.getRowCount(),f=i.getColumnCount(),c=n.hitTestType,l=n.row,g=n.col,h=t.shift,v=t.ctrl,e&&e.Xvt&&(e.Xvt===T.SelectionUnit.row?c=2:e.Xvt===T.SelectionUnit.column&&(c=1)),I=(d=t.Lvt).anchorRow,p=d.anchorCol,x=m=-1,C=y(e,i,l,g,c),0===c?(m=o?i.N9():i.Tb,x=u?i.k9():i.Ab,A=(0,T.Ec)(-1,-1,-1,-1),e.Gvt((0,M.Uvt)(i,A),h,!v,w,C),t.rb=!0):1===c?(C===T.SheetArea.viewport?(m=o?i.N9():i.Tb,A=i.xA(0,x=g,s-1,g,!0),h&&0<=p&&(A=i.xA(0,g,s-1,p,!0)),A=(0,T.Ec)(-1,A.col,-1,A.colCount)):C===T.SheetArea.colHeader&&(A=D(i,m=l,x=g,I,p,h,!0,C)),(b=n.tableSelectInfo&&n.tableSelectInfo.tableSelection)?t.Dse(b,A,l,g,I,p,h,v,C):e.Gvt((0,M.Uvt)(i,A,w,C),h,!v,w,C),t.rb=!0):2===c?(m=l,x=u?i.k9():i.Ab,A=i.xA(l,0,l,f-1,!0),h&&0<=I&&(A=i.xA(l,0,I,f-1,!0)),A=(0,T.Ec)(A.row,-1,A.rowCount,-1),e.Gvt((0,M.Uvt)(i,A),h,!v,w,C),t.rb=!0):3===c&&(x=g,(m=l)!==w)&&g!==w&&(o=n.row,s=n.col,i=(f=(u=n.pivotTableInfo)&&u.getPivotInfoImp(o,s,!1,!0))&&f.area,b=n.tableSelectInfo&&n.tableSelectInfo.tableSelection,!(r&&R.Functions.findGlobalFunction("GETPIVOTDATA")&&!e.Ivt&&u&&f&&4===i)||(e.Fvt=new T.Range(o,s,1,1),c=f.valueFieldName,r=f.rowInfos,o=f.colInfos,j(c))||!r&&!o?t.Dse(b,A,l,g,I,p,h,v,C):(s=t.Pvt(i,c,r,o,u.position()))&&(e.Gvt(s,h,!v,!0,C),t.rb=!0,t.LD=!0)),t.Wk=t.rb,h&&a||(d.anchorRow=m,d.anchorCol=x,d.leadingRow=m,d.leadingCol=x,d.sheetArea=C),t.Rk={e9:n.rowViewportIndex,r9:n.colViewportIndex,Bk:n.hitTestType},t.Ok())},Dse:function(n,t,i,e,r,o,u,a,s){var f,c,l,f=this,c=f.Mf,l=this.Dde();delete l.Fvt,t=n||D(c,i,e,r,o,u,!0,s),l.Gvt((0,M.Uvt)(c,t,w,s),u,!a,w,s),f.rb=!0},Pvt:function(n,t,i,e,r){var o,u,n,a,s,f,r,f,c,r,l,g,u,o,u=this.Mf;if(4===n)return a=n=void 0,f=r.row,r=r.col,f=(s="",T.Ec)(f,r,1,1),n=(0,M.Uvt)(u,f,!0),c=[],r=[],r=Array.isArray(i)&&Array.isArray(e)?i.concat(e):Array.isArray(i)&&i||Array.isArray(e)&&e,l=/\"/g,g='""',r&&r.forEach(function(n){"number"==typeof n.fieldName?c.push(n.fieldName):c.push('"'+n.fieldName.replace(l,g)+'"'),"number"==typeof n.itemName?c.push(n.itemName):c.push('"'+n.itemName.replace(l,g)+'"')}),s=c.join(","),u='GETPIVOTDATA("'+(a=t.replace(l,g))+'",'+n,""!==s&&(u+=","+s),u+")"},qvt:function(n){var t=M.Ode.Ede();return!!t&&t.Rde(n)},Qk:function(){var n,t,i,e,i,e,n=this,t=this.Dde(),i=n.Rk,e=n.Lvt;i&&n.rb&&(i=i.Bk,e=e.sheetArea,t&&t.Xvt&&(t.Xvt===T.SelectionUnit.row?i=2:t.Xvt===T.SelectionUnit.column&&(i=1)),i===T.SheetArea.viewport||e===T.SheetArea.colHeader||e===T.SheetArea.rowHeader?n.tmt():2===i?n.nmt():1===i&&n.emt())},tmt:function(){var n,t,i,e,t,r,o,u,r,o,i,n=this,t=n.Lvt,i=t.anchorRow,e=t.anchorCol,t=t.sheetArea,r=n.Q9(w,t,!0),o=n.K9(w,t,!0);0<=i&&0<=e&&0<=r&&0<=o&&(r=(u=n.Mf).xA(r,o,i,e,!0,t),o=(0,M.Uvt)(u,r,w,t))&&(i=n.Dde(),n.LD?r.equals(i.Fvt)||(delete i.Fvt,i.Gvt(o,!0,!0)):i.Gvt(o,!0,!1)),n.a9()},nmt:function(){var n,t,i,e,i,t,r,n=this,t=n.Lvt.anchorRow,i=n.Q9();0<=t&&0<=i&&(i=(e=n.Mf).xA(i,0,t,e.getColumnCount()-1,!0),i=(0,T.Ec)(i.row,-1,i.rowCount,-1),t=(0,M.Uvt)(e,i))&&(r=n.Dde()).Gvt(t,!0,!1),n.a9()},emt:function(){var n,t,i,e,i,t,r,n=this,t=n.Lvt.anchorCol,i=n.K9();0<=t&&0<=i&&(i=(e=n.Mf).xA(0,i,e.getRowCount()-1,t,!0),i=(0,T.Ec)(-1,i.col,-1,i.colCount),t=(0,M.Uvt)(e,i))&&(r=n.Dde()).Gvt(t,!0,!1),n.a9()},_D:function(){var n,n,n=this;n.l9(),n.Rk=m,n.rb=!1,n.Wk=!1,(n=n.Dde()).onRangeAppend&&n.onRangeAppend()},Mk:function(n){var t,i,e,r,e,r,o,r,i,u,a,u,a,t=this,i=t.Mf,e=t.Dde(),r=n.formulaRangeHitInfo;r&&r.inBorder&&e&&(e.XD&&e.qD(),e.close(),r=(e=r.paramRange)&&e.text,o=j(e.sheetArea)?T.SheetArea.viewport:e.sheetArea,r)&&(r=(0,M.Vvt)(i,r))&&(t.jde(),i=i.JS(r,o),u=n.row,a=n.col,(u=u<i.row?i.row:u)>=i.row+i.rowCount&&(u=i.row+i.rowCount-1),(a=a<i.col?i.col:a)>=i.col+i.colCount&&(a=i.col+i.colCount-1),u=u-i.row,a=a-i.col,t.rb=!0,t.Kk=!0,t.imt={paramRange:e,fromRange:r,rowOffset:u,colOffset:a,sheetArea:o},t.Rk={e9:n.rowViewportIndex,r9:n.colViewportIndex,Bk:n.hitTestType},t.Ok())},Jk:function(){var n,t,i,e,r,o,u,a,s,f,c,l,s,f,l,g,h,v,o,d,I,I,d,I,g,p,n=this;n.rb&&n.Kk&&(i=(t=n.imt).sheetArea,e=n.Q9(w,i,!0),r=n.K9(w,i,!0),0<=e&&0<=r&&(o=t.fromRange,u=t.rowOffset,a=t.colOffset,s=t.toRow,f=t.toCol,l=r,e!==s||l!==f)&&(t.toRow=e,t.toCol=l,f=(s=n.Mf).getRowCount(i),l=s.getColumnCount(i),g=o.row,h=o.col,v=o.rowCount,o=o.colCount,(I=(d=s.Ut).getFreeAreaRowCount(i))<f&&(f=I),(I=d.getFreeAreaColumnCount(i))<l&&(l=I),d=g<0?-1:x(0,A(f-v,e-u)),I=h<0?-1:x(0,A(l-o,r-a)),g=(0,M.Uvt)(s,(0,T.Ec)(d,I,v,o),w,i))&&(p=n.Dde()).Lde(t.paramRange.index,g,!0),n.a9())},ED:function(){var n,n,n=this;n.l9(),n.rb=!1,n.Kk=!1,n.imt=m,(n=n.Dde()).onRangeMoved&&n.onRangeMoved()},Ck:function(n){var t,i,e,r,e,o,u,i,o,a,u,s,f,c,l,t=this,i=t.Mf,e=t.Dde(),r=n.formulaRangeHitInfo;if(r&&e&&(e.XD&&e.qD(),o=(e=r.paramRange)&&e.text,e)&&o&&(u=(0,M.Vvt)(i,o))){if(t.jde(),i=u.row,o=u.row<0?-1:u.row+u.rowCount-1,a=u.col,u=u.col<0?-1:u.col+u.colCount-1,r.inTopLeft)s=o,f=u,c=i,l=a;else if(r.inTopRight)s=o,f=a,c=i,l=u;else if(r.inBottomLeft)s=i,f=u,c=o,l=a;else{if(!r.inBottomRight)return;s=i,f=a,c=o,l=u}t.rb=!0,t.Xk=!0,t.omt={paramRange:e,anchorRow:s,anchorCol:f,toRow:c,toCol:l,sheetArea:n.hitTestType},t.Rk={e9:n.rowViewportIndex,r9:n.colViewportIndex,Bk:n.hitTestType},t.Ok()}},Ik:function(n,t){var i=this.Dde();return!(i&&i.qMi||(i&&i.Dvt()?(this.Kvt(t),0):!this.qvt(n)))},qk:function(){var n,t,i,e,r,o,u,a,s,e,r,a,s,i,o,u,f,c,o,e,u,r,s,n=this;n.rb&&n.Xk&&(t=n.omt,i=T.SheetArea.viewport,t&&!j(t.sheetArea)&&(i=t.sheetArea),e=n.Q9(w,i,!0),r=n.K9(w,i,!0),0<=e&&0<=r&&(o=t.anchorRow,u=t.anchorCol,a=t.toRow,s=t.toCol,r=r,(e=e)!==a||r!==s)&&(t.toRow=e,t.toCol=r,s=(a=n.Mf).getRowCount(i),i=a.getColumnCount(i),u=u<0?i-1:u,f=A(o=o<0?s-1:o,e),c=A(u,r),o=x(o,e)-f+1,e=x(u,r)-c+1,u=n.Dde(),(0===f&&o===s||u&&u.Xvt===T.SelectionUnit.column)&&(o=f=-1),(0===c&&e===i||u&&u.Xvt===T.SelectionUnit.row)&&(e=c=-1),r=t.paramRange,s=(0,M.Uvt)(a,(0,T.Ec)(f,c,o,e),w,r.sheetArea))&&u.Lde(r.index,s,!0),n.a9())},jD:function(){var n,n,t,n=this;n.l9(),n.rb=!1,n.Xk=!1,n.omt=m,(n=n.Dde()).rl&&-(n.umt=1)!==(t=n.text().lastIndexOf(",",n.caret()))&&(n.umt=t+1),n.onRangeResized&&n.onRangeResized()},ZL:function(n,t,i){var e,r,o,u,a,s,f,c,l,g,l,h,h,v,d,I,p,l,e=this.Mf,r=this.Dde(),o=r&&r.smt();if(o&&0!==o.length&&r.cmt&&(u=n.rowViewportIndex,a=n.colViewportIndex,s=n.hitTestType,!this.yD(u,a,t,i)))for(g=o.length-1;0<=g;g--)if(l=(f=o[g]).sheetArea,!1!==f.allowDrag&&(j(l)||l===s)&&!((h=M.Ode.Ede())&&h._text||(c=(0,M.Vvt)(e,f.text),j(c)))){if(j(l)&&(l=T.SheetArea.viewport),(h=e.Ut.findSpan(c.row,c.col,l))&&h.containsRange(c)&&(c=h),d=(l=e.getRangeRect(u,a,c)).x-2,I=l.x+l.width+1-(v=5),p=l.y-2,l=l.y+l.height+1-5,5+d<=t&&t<I&&(1+p<=i&&i<=3+p||1+l<=i&&i<=3+l))return{paramRange:f,inBorder:!0};if(5+p<=i&&i<l&&(1+d<=t&&t<=3+d||1+I<=t&&t<=3+I))return{paramRange:f,inBorder:!0};if(I<=t&&t<5+I&&l<=i&&i<5+l)return{paramRange:f,inBottomRight:!0};if(d<=t&&t<5+d&&l<=i&&i<5+l)return{paramRange:f,inBottomLeft:!0};if(I<=t&&t<5+I&&p<=i&&i<5+p)return{paramRange:f,inTopRight:!0};if(d<=t&&t<5+d&&p<=i&&i<5+p)return{paramRange:f,inTopLeft:!0}}return m},Dde:function(){var n=this.Mf;return n.il||n.mnn||n.Nde},jde:function(){var n=this.Dde();n&&n.mmt()}})},"./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges-render.js":function(n,t,i){var P,L,F,t,U;function c(n,t,i,e,r,o){var u,a,s,f,c,l,g,h,v,d,I,p,m,x,A,C,b,T,A,R,M,j,j,A,w,w,y,D,N,B,k,E,S,O,G,u=n.Mf,a=u.rt,s=u.C6(i,e),f=o&&o.smt(),c=f&&f.length;if(!(c<=0)&&(l=n.uO(i,e,r))){for(t.save(),t.rect(l.x,l.y,l.width,l.height),t.clip(),t.beginPath(),g=[],h=a.isFormulaRangeHovering,v=a.AD,d=a.Kk,I=a.imt,p=a.Xk,m=a.omt,R=0;R<c;R++)if(("number"!=typeof(A=(x=f[R]).sheetArea)||A===s)&&(A=x.text,C=x.ranges&&0<x.ranges.length?x.ranges:[(0,F.Vvt)(u,A)])){if((M=F.Ode.Ede())&&M.Mf&&void 0!==A)if(U.OS(A,"!")){if(j=U.gmt(A,"!"),u.name()!==j&&"'"+u.name()+"'"!==j)continue}else if(j=U.gmt(A,"["),A=u.tables,w=(w=u.NMi)&&w._gi===P.SheetType.tableSheet&&w.name()===j,!(u.getCustomNames()[j]||A&&A.findByName(j)||w))continue;for(b=n.fO(i,e,C,l),y=0;y<b.length;y++)(D=b[y])&&0<D.width&&0<D.height&&(T=o.pmt(R),o.bmt(x)||x.isPivotClickCell?(h&&v.paramRange.index===R&&(t.beginPath(),t.lineWidth=2,t.strokeStyle=T,t.rect(D.x+1,D.y+1,D.width-3,D.height-3),t.stroke()),n.wO(t,D,T)):(h&&v.paramRange.index===R||d&&I.paramRange.index===R||p&&m.paramRange.index===R?(t.beginPath(),t.lineWidth=2,t.strokeStyle=T,t.rect(D.x+1,D.y+1,D.width-3,D.height-3)):(t.beginPath(),t.lineWidth=2,t.strokeStyle=T,t.rect(D.x,D.y,D.width-1,D.height-1)),t.stroke()),o.ymt(x)&&((N=L.Common.ft._(T)).a=.1,t.beginPath(),t.fillStyle=L.Common.ft.j(N),t.fillRect(D.x+1,D.y+1,D.width-3,D.height-3)),g.push({rect:D,color:T,allowDrag:x.allowDrag}))}if(0<g.length&&o.cmt)for(B=g.length,R=0;R<B;R++)D=g[R].rect,T=g[R].color,E=D.x-2,S=D.x+D.width+1-(k=5),O=D.y-2,G=D.y+D.height+1-5,!1===g[R].allowDrag||(M=F.Ode.Ede())&&M._text||(t.beginPath(),t.fillStyle=T,t.fillRect(E,O,5,5),t.fillRect(S,O,5,5),t.fillRect(E,G,5,5),t.fillRect(S,G,5,5));t.beginPath(),t.restore()}}Object.defineProperty(t,"__esModule",{value:!0}),P=i("Core"),L=i("Common"),F=i("./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges.js"),t=P.GC$.extend,U=L.Common.zf,t(P.g7.prototype,{kde:function(){var n,t,t,i,n=this,t=n.Mf;0<t.My||(t=t.Fi(),i=n.J(),n.FA(t.x,t.y,t.width,t.height),n.jy(i))}}),P.Worksheet.ch("formulaReferencedRanges",{paintAdornment:function(n){var t,i,e,r,o,u,a,s,f,t=this,i=n.ctx,e=n.clipRect,r=t.Dn,o=t.Fi(),f=t.rt.Dde();if(f)for(a=-1;a<=2;a++)for(s=-1;s<=2;s++)-1===a&&-1===s||(u=-1===a?o.L1(s):-1===s?o.B1(a):o.c9(a,s))&&0!==u.width&&0!==u.height&&c(r,i,a,s,e,f)}})},"./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges.js":function(n,t,i){var g,e,h,v,a,d;function r(){}function o(n,t){var i,i,e,i;if(t){e=(i=(i=d.Ede())&&i.Mf||n).ui,i=i.ci;try{return g.formulaToRange(n,t,e,i)}catch(n){}}return v}function u(n,t,i,e){var r,o,u,a,u,s,s,f,c,c,i,e,l;return void 0===e&&(e=h.SheetArea.viewport),t?(r=n.Nde,a=(u=(o=d.Ede())&&o.Mf||n).ui,u=u.ci,s=(s=n.parent)&&1===s.options.referenceStyle,f=15,(r&&r.Ivt||i)&&(f=0),t.row<0&&t.col<0&&(t=new h.Range(0,-1,n.getRowCount(),-1)),c=(c=n.tables)&&c.find(t.row,t.col),(o&&o.Ivt||i)&&(f=0),r&&!r.rl&&I(c,t,a)?(o&&o._text&&o.Mf!==n&&(u=-1),g.rangeToFormulaWithStructReference(n,t,a,u,f,s,c)):(i=n.NMi,!c&&e===h.SheetArea.viewport&&i&&i._gi===h.SheetType.tableSheet?p(n,t.col,t.colCount,c=i):(e=g.rangeToFormula(t,a,u,f,s),o&&o._text||r&&r.rl&&r.Smt?(l=(0,h.i2e)(n.name()))+"!"+e:e))):v}function I(n,t,i){if(n){var e=!1,r=!1;if(1===t.rowCount){if(n.hasHeadersRow()&&t.row===n.startRow())return 1;if(n.hasTotalsRow()&&t.row===n.endRow())return 1;if(t.row===i&&t.col>=n.startColumn()&&t.col+t.colCount<=n.startColumn()+n.dataRange().colCount)return 1}else n.hasHeadersRow()&&t.row===n.startRow()&&(t.rowCount===n.dataRange().rowCount+1&&(e=!0),n.hasTotalsRow())&&t.rowCount===n.dataRange().rowCount+1+1&&(e=!0),t.row===n.dataRange().row&&(t.rowCount===n.dataRange().rowCount&&(e=!0),n.hasTotalsRow())&&t.rowCount===n.dataRange().rowCount+1&&(e=!0);return t.col+t.colCount<=n.startColumn()+n.dataRange().colCount&&(r=!0),e&&r}}function s(n){return n&&"["===n[0]&&"]"===n[n.length-1]}function p(n,t,i,e){var r,o,r,e,r,r,i,t,r=f(e),o=r.columns,r=r.groupInfo,e=e.name();if(-1===t&&(t=0),-1===i&&(i=o.length),r){if(r=r.rightGroupColumnIndex,1===i&&t<=r)return"";if(1<i&&t<=r){if(t+i<=r+1)return"";i-=r-t+1,t=r+1}}return 1===i?"".concat(e,"[").concat(o[t].name,"]"):1<i?(r=t+i-1,s(i=o[t].name)||(i="[".concat(i,"]")),s(t=o[r].name)||(t="[".concat(t,"]")),"".concat(e,"[").concat(i,":").concat(t,"]")):""}function f(n){for(var t,i,e,r,o,u,t=[],i=0,e="";e!==v;)e=n.getColumnName(i),o=void 0,n.Mf.NMi&&(o=n.FDi(i))&&(r=i),i++,e!==v&&t.push({name:e,description:"",isGroupColumn:o});return u={columns:t},a(r)||(u.groupInfo={rightGroupColumnIndex:r}),u}function c(n,t,i,e,r){var o,u,e,o,o=n.rowRelative,u=n.columnRelative;e&&(o&&u?(n.rowRelative=!1,n.columnRelative=!1,n.row+=t,n.column+=i):!o&&u?(n.rowRelative=!0,n.columnRelative=!1,n.row-=t,n.column+=i):(n.columnRelative=!0,n.column-=i)),e=n.endRowRelative,o=n.endColumnRelative,r&&(e&&o?(n.endRowRelative=!1,n.endColumnRelative=!1,n.endRow+=t,n.endColumn+=i):!e&&o?(n.endRowRelative=!0,n.endColumnRelative=!1,n.endRow-=t,n.endColumn+=i):(n.endColumnRelative=!0,n.endColumn-=i))}function l(n,t,i){var e=n.rowRelative,r=n.columnRelative;e&&r?(n.rowRelative=!1,n.columnRelative=!1,n.row+=t,n.column+=i):!e&&r?(n.rowRelative=!0,n.columnRelative=!1,n.row-=t,n.column+=i):(n.columnRelative=!0,n.column-=i)}Object.defineProperty(t,"__esModule",{value:!0}),t.dmt=t.lmt=t.Uvt=t.Vvt=t.Ode=void 0,g=i("SheetsCalc"),e=i("Common"),h=i("Core"),v=null,a=e.Common.lt.ht,r.Ede=function(){return r.DJ},d=r,t.Ode=d,t.Vvt=o,t.Uvt=u,t.lmt=c,t.dmt=l,h.GC$.extend(h.Hv.prototype,{C2:function(n){return!n||!n.Nde||!n.Nde.Dvt()},D2:function(n){return!n||!n.Nde||!!n.Nde.xmt}})},"./dist/plugins/formulaTextbox/formulaTextBox.entry.js":function(n,t,i){var e,r,o,u,a,e=this&&this.__createBinding||(Object.create?function(n,t,i,e){void 0===e&&(e=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(n,e,r)}:function(n,t,i,e){n[e=void 0===e?i:e]=t[i]}),r=this&&this.__exportStar||function(n,t){for(var i in n)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||e(t,n,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.findControl=void 0,o=i("Core"),r(i("./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges.js"),t),i("./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges-event.js"),i("./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges-render.js"),r(i("./dist/plugins/formulaTextbox/formulatextbox.js"),t),r(i("./dist/plugins/formulaTextbox/formulatextbox-acrosssheet.js"),t),i("./dist/plugins/formulaTextbox/formulatextbox-event.js"),i("./dist/plugins/formulaTextbox/formulatextbox-render.js"),i("./dist/plugins/formulaTextbox/formulatextbox-actions.js"),u=i("./dist/plugins/formulaTextbox/formulatextbox.js"),t.findControl=a=function(n){return"string"==typeof n&&(n=document.getElementById(n)),(0,o.GC$)(n).data(u.CONST_FORMULATEXTBOX)}},"./dist/plugins/formulaTextbox/formulatextbox-acrosssheet.js":function(n,t,i){var h,e,v,r,d,I,o,u,a;function s(n){var t,i,t=h.mt.En("textarea"),i;return(0,h.GC$)(t).css({display:"none"}),(0,h.GC$)(n).append(t),t}function f(n,t){var i,n,t,t;n&&n.il&&(i=n.il.Kmt,n=n.il.Jmt,t=t?"addClass":"removeClass",i&&(0,h.GC$)(i)[t](r),n)&&(0,h.GC$)(n)[t](r)}function c(){var n=this;n.bZ=-1,n.mvt=-1,n._text="",n.gvt=-1,n.Mf=null,n.XD=!1,n.pvt=-1,n.bvt=null,n.Vv=null,n.yvt=null}function l(){}Object.defineProperty(t,"__esModule",{value:!0}),t.wvt=t.Mvt=void 0,h=i("Core"),e=i("./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges.js"),v=i("./dist/plugins/formulaTextbox/formulatextbox.js"),r="gc-across-sheet-func-popup",d=null,I=void 0,t.Mvt=s,c.prototype.d5=function(){var n=this;n.Cvt(),n.bZ=-1,n.mvt=-1,n._text="",n.gvt=-1,n.XD=!1,n.pvt=-1,n.Mf=null,n.Vv=null,n.yvt=null},c.prototype.Cvt=function(){var n,t,i,n=this;n.Mf.xT||(t=n.Mf.getCellType(n.bZ,n.mvt),i={sheet:n.Mf,row:n.bZ,col:n.mvt,sheetArea:3},n.bvt&&n.bvt.firstChild&&t.deactivateEditor(n.bvt.firstChild.firstChild,i)),(0,h.GC$)(n.bvt).remove(),n.bvt=null},c.prototype.Svt=function(n){var t,i,e,t=this,i=n.il;i&&(e=n.vA,t._text=i.text(),t.bZ=e?e.row:n.getActiveRowIndex(),t.mvt=e?e.col:n.getActiveColumnIndex(),t.nT=e?e.sheetArea:h.SheetArea.viewport,t.gvt=i.caret(),t.XD=i.XD,t.pvt=i.Tvt(),t.rl=i.rl,t.Avt=i.Avt,t.Ivt=i.Ivt,t.Mf=n,t.Vv=n.parent,t.yvt=n.rt.it())},c.prototype._6=function(n){var t=this;n.il&&t.Mf&&(t._text=n.il.text(),t.gvt=n.il.caret(),t.XD=n.il.XD,t.pvt=n.il.Tvt())},c.prototype.xvt=function(n){var t,n,t=this,n=n.il;n&&(n.rl=t.rl,n.Avt=t.Avt,n.Ivt=t.Ivt,n.text(t._text),n.caret(t.gvt),t.XD)&&(n.Nvt(),n.Tvt(t.pvt))},c.prototype.kvt=function(n){var t,i,e,r,t=n.oldSheet,i=this,e=t&&t.il;if(e)if(e.close(),(!i.Mf||i.Mf.xT)&&e.Dvt()||i.Avt!==e.Avt){i.Svt(t),r=t.getValue(i.bZ,i.mvt,i.nT),t.suspendEvent();try{if(!t.endEdit(!0))return}finally{t.resumeEvent()}t.setValue(i.bZ,i.mvt,r,i.nT,!0),t.Di=1,n.needTriggerSheetChange=!1}else i._text&&(i._6(t),e.destroy(),t.il=d,t.Nde=d,n.needTriggerSheetChange=!1)},c.prototype._vt=function(n){var t,n,i,e,e,r,e,r,t=n.oldSheet,n=n.newSheet,i=this;if(n&&!n.xT){if(i.bvt&&""===i._text&&(t&&t.cR(),f(n,!1),i.d5()),i._text&&i.Mf===n)n.Di=0,n.Zg(),n.suspendEvent(),i.rl?(e=s(n.parent.Ti),(0,v.Evt)(n,e,d,n.ui,n.ci,3),n.Di=2,n.Dn.ID()):(r=e=void 0,i.nT===h.SheetArea.rowHeader?r=-(e=1):i.nT===h.SheetArea.colHeader&&(e=-1,r=1),n.f6(n.Dg(),i.bZ,i.mvt,e,r,!1)),n.resumeEvent(),i.xvt(n),i.GG(n,i.bZ,i.mvt,i.nT),t&&t.cR(),f(n,!1),i.d5();else if(i._text&&!i.bvt){if(n.Di=1,t&&(t.Di=1),i.jvt(n),f(n,!0),!i.Mf||i.Mf.xT)return;n.e4()}else if(i._text&&i.Mf!==n){if(n.Di=1,t&&(t.Di=1,t.cR()),i.jvt(n),f(n,!0),!i.Mf||i.Mf.xT)return;n.e4()}(e=i.Mf)&&(r=n.il)&&(r.U6=e!==n)}},c.prototype.jvt=function(n){var t,i,e,r,o,u,a,s,f,c,l,c,l,g,t=this,i=t.Mf;i&&!i.xT&&(e=t.bZ,r=t.mvt,o=t.nT,u=i.getCellType(e,r,o),a={sheet:i,row:e,col:r,sheetArea:o,canvasOffset:this.yvt},(s=u.isImeAware(a))||o!==h.SheetArea.viewport)&&(n.Di=1,f=u.jn(a),t.bvt&&t.Cvt(),l=c=void 0,t.nT===h.SheetArea.rowHeader?l=-(c=1):t.nT===h.SheetArea.colHeader&&(c=-1,l=1),t.bvt=f,(0,h.GC$)(f).css("position","absolute"),(c=i.getCellRect(e,r,c,l)).width===I&&(c.width=0),c.height===I&&(c.height=0),(0,h.GC$)(f).attr("id","across"),(0,h.GC$)(f).addClass("gc-across-sheet-ftb"),l=i.getActualStyle(e,r,o),u.On(f,l,c,a),(g=t.Vv&&t.Vv.getHost()||document.body).insertBefore(f,d),t.rl&&(0,h.GC$)(f).css({display:"none"}),(0,v.Evt)(n,u.getEditingElement(),!0,n.ui,n.ci,3),f.firstChild&&!t.rl&&u.focus(f.firstChild.firstChild),t.xvt(n),u.Rn(f,l,c,a))},c.prototype.GG=function(n,t,i,e){var r,o,u,a,s,f,r,o,c;e===h.SheetArea.rowHeader?o=-1:e===h.SheetArea.colHeader&&(r=-1),u=n.getCellType(t,i,e),a=n.li,s=n.Fi(),f=n.getActualStyle(t,i,e),r=n.getCellRect(t,i,r,o),o=!1,e===h.SheetArea.rowHeader?o=r.x>=s.x&&r.y>=s.y+s.qC&&r.x+r.width<=s.Py&&r.y+r.height<=s.Ay+s.Iy:e===h.SheetArea.colHeader?o=r.x>=s.x+s.XC&&r.y>=s.y&&r.x+r.width<=s.Hy+s.zy&&r.y+r.height<=s.Cy:e===h.SheetArea.viewport&&(o=r.x>=s.b6&&r.y>=s.T6&&r.x+r.width<=s.Hy+s.zy&&r.y+r.height<=s.Ay+s.Iy),r&&0<r.width&&0<r.height&&o&&a&&a.parentNode&&u.Rn(a.parentNode.parentNode,f,r,c={sheet:n,row:t,col:i,sheetArea:e})},c.prototype.Rde=function(n){var t,i,e,r,t=this;if(!t.bvt)return!1;if(i=!1,e=t.Mf,(r=n.il)&&e.setFormula(t.bZ,t.mvt,r.text()),e!==n){if(h.Commands.VA.Yvt(e),!e.endEdit())return;i=!0}else r&&(r.destroy(),n.il=d,n.Nde=d),t.d5();return i},o=c,l.Ovt=function(n,t){(l.Rvt=l.Rvt?l.Rvt:new o).kvt(t)},l.Bvt=function(n,t){(l.Rvt=l.Rvt?l.Rvt:new o)._vt(t)},t.wvt=u=l,a=e.Ode.Ede,e.Ode.Ede=function(){return a()||u.Rvt}},"./dist/plugins/formulaTextbox/formulatextbox-actions.js":function(n,t,i){var m,t,r,o,x,u,A,a;function C(n){var t,t,i,t=n.il,i=n.rt,t=t.XD?i.Lvt:i.Lvt={anchorRow:n.ui,anchorCol:n.ci,leadingRow:n.qA,leadingCol:n.hR};return t}function s(n,t,i,e,r){var o,u,u,u,a,s,f,c,a,s,t,l,g,h,u,v,d,I,p,l,g,I,p,l,o=n.il,u=n.parent,u=u&&u.options;if(o&&o.Dvt()&&u&&u.allowUserEditFormula&&u.enableFormulaTextbox){switch(a=(u=C(n)).anchorRow,s=u.anchorCol,f=u.leadingRow,c=u.leadingCol,A(e)&&(e=a),A(r)&&(r=s),a=n.rt,t){case 3:h=n.sI(e,r,i,f);break;case 4:h=n.uI(e,r,i,f);break;case 1:h=n.lR(e,r,i,c);break;case 2:h=n.gR(e,r,i,c);break;case 5:h=n.yR();break;case 6:h=n.bR()}h&&(s=h.row,t=h.col,l=h.leadingCellRow||s,g=h.leadingCellCol||t,n.dR(s,t))&&(u.anchorRow=s,u.anchorCol=t,u.leadingRow=l,u.leadingCol=g,u=n.pivotTables&&n.pivotTables.findPivotTable(l,g),v=o.shift,d=o.ctrl,p=(I=u&&u.getPivotInfoImp(l,g,!1,!0))&&I.area,!o.Ivt&&u&&I&&4===p?(o.Fvt=new m.Range(l,g,1,1),l=I.valueFieldName,g=I.rowInfos,I=I.colInfos,(g||I)&&(p=n.rt.Pvt(p,l,g,I,u.position()))&&(o.Gvt(p,v,!d,!0),o.rb=!1)):(delete o.Fvt,(l=(0,x.Uvt)(a.Mf,(0,m.Ec)(s,t,1,1)))&&o.Gvt(l,!1,!0)),0<=s)&&0<=t&&n.OA(s,t)}}function e(n,t){var i;return!!n&&2!==n.Di&&((i=n.il)&&i.Dvt()?s(n,t,!1):(n=i?a.Hvt(n):n).G5(t,!1),!0)}function f(n,t,i,e){var r;return!!n&&2!==n.Di&&((r=n.il)&&r.Dvt()?s(n,t,!1,i,e):(n=r?a.Hvt(n):n).G5(t,!1,i,e),!0)}function c(n,t,i){var e,r,r,r,o,u,o,a,a,n,a,e=n.il,r=n.parent,r=r&&r.options;e&&e.Dvt()&&r&&r.allowUserEditFormula&&r.enableFormulaTextbox&&(r=n.rt,u=(o=C(n)).anchorRow,o=o.anchorCol,a=e.XD?(a=e.zvt(),(0,x.Vvt)(n,a.text)):(0,m.Ec)(u,o,1,1))&&(n=n.HR(a,t,i,u,o),a=(0,x.Uvt)(r.Mf,n))&&e.Gvt(a,!0,!1)}function l(n,t,i){if(n){if(2===n.Di)return!1;var e=n.il;if(e&&e.Dvt())c(n,t,i);else{if(!(n=e?a.Hvt(n):n).endEdit())return!1;n.HA(t,i)}return!0}return!1}function g(){}Object.defineProperty(t,"__esModule",{value:!0}),m=i("Core"),t=i("Common"),r=i("./dist/plugins/formulaTextbox/formulatextbox.js"),o=i("./dist/plugins/formulaTextbox/formulatextbox-acrosssheet.js"),x=i("./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges.js"),u=void 0,A=t.Common.lt.ht,m.Commands.B5=e,m.Commands.UA=f,m.Commands.L5=l,g.YA=function(n){return g.Hvt(n)},g.ZA=function(n){return g.Hvt(n)},g.WA=function(n){return g.Hvt(n)},g.Hvt=function(n){var n,t,n=n,t=o.wvt.Rvt;return t&&t._text&&t.Mf&&(n=t.Mf,g.Yvt(n)),n},g.Yvt=function(n,t){var i,e;void 0===t&&(t=!0),i=n.parent,(e=o.wvt.Rvt)&&e._text&&i.e3(n,t)},g.KA=function(n,t,i){var e,r,o,t,e=!1,r=n.il;return r&&r.Dvt()?((o=C(n)).anchorRow=t,o.leadingRow=t,(t=(0,x.Uvt)(n,(0,m.Ec)(o.anchorRow,o.anchorCol,1,1)))&&r.Gvt(t,!1,!0),n.$A(i),e=!0):r&&(n=g.Hvt(n)),{sheet:n,r:e}},g.eI=function(n,t,i){var e,r,o,t,e=!1,r=n.il;return r&&r.Dvt()?((o=C(n)).anchorRow=t,o.leadingRow=t,(t=(0,x.Uvt)(n,(0,m.Ec)(o.anchorRow,o.anchorCol,1,1)))&&r.Gvt(t,!1,!0),n.$A(i),e=!0):r&&(n=g.Hvt(n)),{sheet:n,r:e}},g.Zvt=function(n,t){var i,t,e,r,o,i=!1,t=t?5:6,e=n.il,r=n.ui,o=n.ci;return e&&e.Dvt()?(e.XD||(n.rt.Lvt={anchorRow:r,anchorCol:o,leadingRow:n.qA,leadingCol:n.hR}),s(n,t,!1,r,o),i=!0):e&&(n=g.Hvt(n)),{sheet:n,r:i}},g.iI=function(n){return g.Zvt(n,!0)},g.rI=function(n){return g.Zvt(n,!1)},g.oI=function(n){return g.Hvt(n)},g.aI=function(n){return g.Hvt(n)},g.cI=function(n){var t,i,e,t,t=o.wvt.Rvt;if(t&&t._text&&t.Mf&&(n=t.Mf,i=t.bZ,e=t.mvt,g.Yvt(n,!1),(0,r.Wvt)(n),t.rl||n.t4(i,e,u,u,1),n.isEditing()))return t=n.getValue(i,e,3),!!n.ol(!0,void 0,void 0,!0)&&(n.setValue(i,e,t,3,!0),!0)},a=g,m.Commands.VA=a},"./dist/plugins/formulaTextbox/formulatextbox-event.js":function(n,t,i){var t,h,v,d,i,I;Object.defineProperty(t,"__esModule",{value:!0}),t=i("Core"),h=i("CalcEngine"),v=i("SheetsCalc"),d=i("./dist/plugins/formulaTextbox/formulaReferencedRanges/formulaReferencedRanges.js"),i=t.GC$.extend,I=null,i(t.nk.prototype,{hI:function(){var n,t,i,e,r,o,o,u,a,s,f,c,l,t,g,o,n,t=this.Mf,i=t.il;if(i)if(e=t.ui,r=t.ci,o=(o=t.parent)&&1===o.options.referenceStyle,u=new v.SheetParserContext(t,o,(0,h.eV)(e,r)),a=new h.Parser,i.XD)for(c=i.fmt(),l=0;l<c.length;l++){s=c[l];try{f=a.parse(u,s.text)}catch(n){f=I}f&&1===f.type&&((0,d.lmt)(f,e,r,!0,!0),i.Lde(s.index,a.unparse(u,f)))}else if(s=i.zvt()){try{f=a.parse(u,s.text)}catch(n){f=I}f&&1===f.type&&(f.isFullColumn||f.isFullRow?((0,d.lmt)(f,e,r,!0,!0),i.Lde(s.index,a.unparse(u,f))):f.hmt()?((0,d.dmt)(f,e,r),i.Lde(s.index,a.unparse(u,f))):(t=s.textOffset+s.text.lastIndexOf(":"),(g=i.caret()<=t)?((0,d.lmt)(f,e,r,!0,!1),o=a.unparse(u,f),i.Lde(s.index,o),i.caret(s.textOffset+o.lastIndexOf(":"))):((0,d.lmt)(f,e,r,!1,!0),i.Lde(s.index,a.unparse(u,f)))))}}})},"./dist/plugins/formulaTextbox/formulatextbox-render.js":function(n,t,i){var t,e;Object.defineProperty(t,"__esModule",{value:!0}),(e=(t=i("Core")).GC$.extend)(t.g7.prototype,{ID:function(){this.kde()}})},"./dist/plugins/formulaTextbox/formulatextbox.js":function(t,s,n){var p,L,h,m,l,x,f,c,F,e,u,g,v,d,I,a,i,A,C,r,b,T,R,o,M,j,w,y,U,Z,z,_,Y,D,N,B,Q,W,V,X,K,H,J,q,$,nn,tn,E,S,O,en,n,rn,on,un;function an(n,t){for(var i,e,i=0,e=0;e<n.length;e++)n[e]===t&&i++;return i}function sn(){var i=[];return m.GC$.each(p.sR().wmt,function(n,t){p.Functions.Mmt[n]&&(t.name=n,i.push(t))}),i}function fn(n){var i=[],e;return m.GC$.each(n,function(n,t){(e=t.description())&&(e.name=n,i.push(e))}),i}function G(n){var t,t,t=p.getMapping()&&p.getMapping().builtInFunctionsMapping,t=t&&t[n]&&t[n].alias||n;return d.j0(t)}function cn(n,t,i){var i;return i?(i=new RegExp(O,"g"),n.replace(i,"")===t.replace(i,"")):n===t}function ln(n){for(var t,i,e,r,o,u,t=[],i=0,e="";e!==x;)e=n.getColumnName(i),o=void 0,n.Mf.NMi&&(o=n.FDi(i))&&(r=i),i++,e!==x&&t.push({name:e,description:"",isGroupColumn:o});return u={columns:t},a(r)||(u.groupInfo={rightGroupColumnIndex:r}),u}function gn(i,n,t,e,r,o){var u,a,t,n,s,f,c,u=i.parent,a=u&&u.options;(n&&a&&a.allowUserEditFormula&&a.enableFormulaTextbox||t)&&(i.il&&i.il.destroy(),i.il=new un(n,null,u),i.Nde=i.il,t=i.il.text(),n=i.getFormulaInformation(e,r,o),t[0]!==en||n&&n.hasFormula||t===en||a.allowInvalidFormula||i.il.text(t="'"+t),s=i.il,f=i.rt,c=i.Dn,s.bind("AppendStarted",function(){s.close();var n=i.Di;1!==n&&(i.Di=1,i._i(n,1))}),s.bind("AppendEnded",function(){c.ID()}),s.bind(w,function(n,t){var t;i.xT||(t&&t.type!==b&&(f.By(t),t=i.getCellType(e,r,o),i.ki(m.Events.EditChange,{sheet:i,sheetName:i.name(),row:e,col:r,editingText:t.getEditorValue(i.li)})),c.ID(),i.ki(m.Events.FormulaTextBoxTextChanged,{sheet:i,sheetName:i.name(),text:s.text(),sheetArea:o}))}),s.bind("CaretChanged",function(){c.ID(),i.ki(m.Events.FormulaTextBoxCaretChanged,{sheet:i,sheetName:i.name(),caret:s.caret()})}),s.add(sn()),s.add(fn(p.Functions.Tmt)),s.add(fn(i.Amt).concat(fn(u.Amt))),c.ID())}function hn(n){n.il&&(n.il.destroy(),n.il=x,n.Nde=x,n.Dn.ID());var t=n.parent&&n.parent.h6;v.activeElement===(t&&t.Ti)&&n.rt.aA()}function vn(n,t){var n,i,e,i,e,r,i,n,o,e,o,n=(0,m.GC$)(n);return n.attr("contenteditable","false"),i=u("table"),(0,m.GC$)(i).css("border-spacing","0"),(0,m.GC$)(i).css("width","100%"),n.append(i),e=u("tbody"),i.appendChild(e),i=document.createElement("tr"),e.appendChild(i),e=document.createElement("td"),(0,m.GC$)(e).css("padding-right","0px"),i.appendChild(e),r=document.createElement("td"),(0,m.GC$)(r).css("width","23px"),(0,m.GC$)(r).css("padding-right","0px"),i.appendChild(r),i=n.width()-(0,m.GC$)(r).width(),n=u("div"),o=u("div"),(0,m.GC$)(o).width(i),(0,m.GC$)(o).css({"overflow-y":"auto","overflow-x":"hidden",height:"20px"}),o.appendChild(n),e.appendChild(o),e=u("div"),r.appendChild(e),(0,m.GC$)(n).css({display:"inline-block",float:"left",height:"auto",outline:"none"}),(0,m.GC$)(n).width(i),(0,m.GC$)(n).attr("contenteditable","true"),(0,m.GC$)(n).attr("spellcheck","false"),(o=(0,m.GC$)(e)).css({display:"block",float:"right",width:"23px",height:"23px",background:q,"background-repeat":"no-repeat"}),o.bind("click",function(){t.Imt?(t.Vv.ki("RangeSelectEnding",t),t.endSelectMode()):t.startSelectMode()}),{contentDiv:n,button:e}}function dn(n){for(var t,i,t=["FILTER","RANDARRAY","SEQUENCE","SORT","SORTBY","UNIQUE","MAP","REDUCE","SCAN","MAKEARRAY","BYROW","BYCOL","TEXTSPLIT","HSTACK","VSTACK","TOROW","TOCOL","WRAPROWS","WRAPCOLS","TAKE","DROP","EXPAND","CHOOSEROWS","CHOOSECOLS"],i=0;i<t.length;i++)if(n===t[i])return 1}function k(n,t,i,e){var r,o,e,t,u,a,r=this,o=n;if(r.rl=!1,r.Ivt=!1,r.xmt=!0,r.Smt=!0,r.Nmt=[],r.kmt=[],r.Dmt=[],r.U6=!1,r.Zpe=!!e,t&&t.rangeSelectMode&&(!0===t.absoluteReference&&(r.Ivt=!0),!1===t.needSheetName&&(r.Smt=!1),!1===t.acrossSheet&&(r.xmt=!1),r.Lve=t.needFuncHelp,r.Xvt=t.selectionUnit,r.rl=!0,r.Imt=!1,r._mt=!1,o=(e=vn(r.Emt=n,r)).contentDiv,r.jmt=e.button,r.Omt=n,r.Avt=on,on++),r.cmt=!0,r.Hc(i&&i.getHost()||v.body),o&&r.Rmt(o),i&&(r.Bmt=!0,r.Lmt(i),r.Vv._3(m.Events.ActiveSheetChangingInternal+M,l.wvt.Ovt),r.Vv.D3(m.Events.ActiveSheetChangingInternal+M,l.wvt.Ovt),r.Vv._3(m.Events.ActiveSheetChangedInternal+M,l.wvt.Bvt),r.Vv.D3(m.Events.ActiveSheetChangedInternal+M,l.wvt.Bvt),r.Vv._3(m.Events.FormulaTextBoxUpdatePosition+R,void 0),r.Vv.D3(m.Events.FormulaTextBoxUpdatePosition+R,function(n,t){r.u_()})),t=r.text(),r.Fmt=r.Ost(t),u=r.vmt(o)){r.Pmt(r.Fmt);try{(a=g.getSelection()).selectAllChildren(o),0<a.rangeCount&&a.collapseToEnd()}catch(n){}(0,m.GC$)(r.Ti).data(E,t)}(0,m.GC$)(n).data(s.CONST_FORMULATEXTBOX,r)}function In(){var n,t,i,t,n=g.getSelection();0<n.rangeCount&&(t=n.getRangeAt(0),(i=v.createElement("span")).innerHTML="<br/>\u200b",t.insertNode(i),(t=v.createRange()).setStartAfter(i),t.setEndAfter(i),t.collapse(!1),n.removeAllRanges(),n.addRange(t))}function P(n){return"gcAttachedFormulaTextBox"===n.target.getAttribute("gcuielement")}Object.defineProperty(s,"__esModule",{value:!0}),s.FormulaTextBox=s.Wvt=s.Evt=s.CONST_FORMULATEXTBOX=void 0,p=n("CalcEngine"),L=n("SheetsCalc"),h=n("Common"),m=n("Core"),l=n("./dist/plugins/formulaTextbox/formulatextbox-acrosssheet.js"),x=null,f=void 0,c=Math.max,F=Math.min,e=m.GC$.extend,u=m.mt.En,g=window,v=document,d=h.Common.zf,I=m.mt.vi,a=h.Common.lt.ht,i=m.mt.Tt,A=i.msie&&parseInt(i.version,10)<10,C=d.Gmt,s.CONST_FORMULATEXTBOX="formulatextbox",r="gcUIElement",b="input",T="\xa0",R=".gcFormulaTextBoxInternal",o=".gcFormulaTextBox",M=".gcFormulaTextBoxAcrossSheetInternal",j=".gcsj-func-ac-row",w="TextChanged",y="CaretChanged",U="AppendStarted",Z="AppendEnded",_=37,Y=39,D=38,N=40,B=9,Q=13,W=33,V=34,X=35,K=36,H=27,J=["#0000ff","#008000","#9900cc","#800000","#00cc33","#cc6600","#cc0099"],q='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAARCAIAAACw+gCQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJSSURBVDhPY3hILqBYZ/eqV81LXpbNfp7S/yS0+Z5p+olD5x5OWXGyYcaBmql7yifuLOnbBkRFPVuACKIFqjNzwv2Qhhue5ReByK/qYlDtxb///n35+efd1z/PP/wB6vn2+/f7b79ffgIhiBaoTlPP5I2bN2/asmX7jh3Hjh+ft3wLUOfX779ef/h+6+nHtXsuffrx+/bj16euvwQiiBaETiAy904NTasGantRkvA8wetpsO0NJ839htKb9l/Jal6T3rgytX4FEEG0QHXuOnbr55+/P379AyIg40m8x8uZ3U+aC49bKn64eHzX0es4Xds0Y9ejl++vPXx3+f77Nx9/3PU3e5YR/CTM4WGs53pVPqBrgX6+8+QNFtdmNq0q6NpU1LOpe/6+o+fvH3fR36XCc9dE/KG3EdDNQPaF7VunLTuY0bA0omg2RAtUZ1LNUohjgCEJDJVtdlpPty6dr8x3yUDsvoPqRm2hqcp8Jy+9WbH/7cQ1EB0wnXEVCyBBt+fc8+NXXy9Yf/znz5/31swFaliiKjBZme/yrSe7z36YsuZBy4KbEC1QnRFFcxKqFgP1A1Fq7ZKcpqU1EzYuWX/kxIa1/WBtizYcAwqG5E71SZsA0QLVGZI3A+Lax+/+ACMwvHDmsn1v1xx8e+jSp83HXgP1ALmztryYsv4ZEEG0QHUGZk+FuHbHqadABORO3fC8Z/mdvmU3Oxdd9cuY1LX0VsOci/WzQQiiBaET4lQgii1fEFU6F4iAXgC6JShnakDWZKBmoDshCKIFqpMMQK7Ohw8BTajNa73pg9oAAAAASUVORK5CYII=")',$='url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8dGl0bGU+U1BKUyBBbm90aGVyLVNlbGVjdGluZzwvdGl0bGU+CiAgICA8ZyBpZD0iU1BKUy1Bbm90aGVyLVNlbGVjdGluZyIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9IlN3aXRjaC1yb3cvY29sdW1uIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjAwMDAwMCwgMS4wMDAwMDApIj4KICAgICAgICAgICAgPHJlY3QgaWQ9IlJlY3RhbmdsZS04IiBmaWxsPSIjRDVENUQ1IiB4PSIwIiB5PSIwIiB3aWR0aD0iMTYiIGhlaWdodD0iMTMiPjwvcmVjdD4KICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgZmlsbD0iI0ZGRkZGRiIgeD0iMyIgeT0iNSIgd2lkdGg9IjEwIiBoZWlnaHQ9IjQiPjwvcmVjdD4KICAgICAgICAgICAgPHBhdGggZD0iTTMsNSBMMTMsNSBMMTMsOSBMMyw5IEwzLDUgWiBNNCw2IEw0LDggTDEyLDggTDEyLDYgTDQsNiBaIiBpZD0i55+p5b2iIiBmaWxsPSIjNjY2NjY2IiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICAgICAgPHBhdGggZD0iTTAsMCBMMTYsMCBMMTYsMTMgTDAsMTMgTDAsMCBaIE0xLDEgTDEsMTIgTDE1LDEyIEwxNSwxIEwxLDEgWiIgaWQ9IuefqeW9oiIgZmlsbD0iIzY2NjY2NiIgZmlsbC1ydWxlPSJub256ZXJvIj48L3BhdGg+CiAgICAgICAgICAgIDxnIGlkPSLnvJbnu4QtOCI+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiBmaWxsPSIjODFCRUZDIiB4PSIxIiB5PSIxIiB3aWR0aD0iMTQiIGhlaWdodD0iMiI+PC9yZWN0PgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2LDAgTDE2LDQgTDAsNCBMMCwwIEwxNiwwIFogTTE1LDEgTDEsMSBMMSwzIEwxNSwzIEwxNSwxIFoiIGlkPSLlvaLnirbnu5PlkIgiIGZpbGw9IiMzNjdGQzkiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDxnIGlkPSLnvJbnu4QtOSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMi41ODc3NjcsIDYuMDAwMDAwKSIgZmlsbC1ydWxlPSJub256ZXJvIj4KICAgICAgICAgICAgICAgIDxwb2x5Z29uIGlkPSJTaGFwZSIgZmlsbD0iI0ZBNzU0MSIgcG9pbnRzPSI1LjQxMjIzMjg1IDcgMi40MTIyMzI4NSAzLjk5NTM1Mjk1IDQuNDEyMjMyODUgMy45OTUzNTI5NSA0LjQxMjIzMjg1IDEgNi40MTIyMzI4NSAxIDYuNDEyMjMyODUgMy45OTUzNTI5NSA4LjQxNDAzOTk4IDMuOTk1MzUyOTUiPjwvcG9seWdvbj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMC44MjY2NDAyLDIuOTk1MzUyOTUgTDUuNDEyMDE5ODEsOC40MTUwOTU5NCBMMC4wMDA2NTkxMTExNjIsMi45OTUzNTI5NSBMMy40MTIyMzI4NSwyLjk5NTM1Mjk1IEwzLjQxMjIzMjg1LDAgTDcuNDEyMjMyODUsMCBMNy40MTIyMzI4NSwyLjk5NTM1Mjk1IEwxMC44MjY2NDAyLDIuOTk1MzUyOTUgWiBNNS40MTIyMzI4NSw3IEw4LjQxNDAzOTk4LDMuOTk1MzUyOTUgTDYuNDEyMjMyODUsMy45OTUzNTI5NSBMNi40MTIyMzI4NSwxIEw0LjQxMjIzMjg1LDEgTDQuNDEyMjMyODUsMy45OTUzNTI5NSBMMi40MTIyMzI4NSwzLjk5NTM1Mjk1IEw1LjQxMjIzMjg1LDcgWiIgaWQ9IlNoYXBlIiBmaWxsPSIjRkZGRkZGIj48L3BhdGg+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==")',nn="background",tn="background-repeat",E="text-before",S="caret-before",O="\u200b",en="=",m.Events.FormulaTextBoxTextChanged="FormulaTextBoxTextChanged",m.Events.FormulaTextBoxCaretChanged="FormulaTextBoxCaretChanged",m.Events.FormulaTextBoxUpdatePosition="FormulaTextBoxUpdatePosition",g.gcGlobal.wf.push(function(n,t){var i,t,i=l.wvt;!t&&n.endEdit&&i&&(t=i.Rvt)&&t.bvt&&n.il&&(n.il&&n.il.destroy(),n.il=x,n.Nde=x,t.rl||t.d5())}),s.Evt=gn,s.Wvt=hn,m.Worksheet.ch(s.CONST_FORMULATEXTBOX,{startEdit:function(n){n.preventFormulaTextBox||gn(this,n.element,f,n.row,n.col,n.sheetArea)},endEdit:function(){hn(this)},preProcessKeyDown:function(n){var t,t,i,i,t=this.il;(t&&t.$D(n.e)||(i=(t=this.parent)&&t.h6)&&i.$D(n.e,n.c)||(i=t&&t.vCe)&&i.$D(n.e,n.c))&&(n.r=!0)}}),n=m.Hv.prototype,rn=n.O2,m.Hv.ch(s.CONST_FORMULATEXTBOX,{preProcessMouseDbClick:function(n){var t,t,t,i,t=(0,m.jf)(this.Vv),t=t?t.il:void 0,t=t&&t.Dvt(),i=l.wvt.Rvt;t?n.r=!1:i&&i.bvt&&i.d5()}}),n.O2=function(){var n=(0,m.jf)(this.Vv),n=n&&n.il,t=l.wvt.Rvt,t=t&&t._text;return rn.call(this)&&!t&&!n},on=1,k.prototype.Umt=function(n){var t,i,e,i,n,r,o,t=this;t.Hmt(),t.FD(),t._mt=!0,i=(0,l.Mvt)(t.Vv.Ti),(e=(t.Vv.vCe=t).zmt())&&(e.suspendPaint(),gn(e,i,!0,e.ui,e.ci,3),(i=e.il).rl=!0,i.Avt=t.Avt,i.Ivt=t.Ivt,i.Smt=t.Smt,i.Xvt=t.Xvt,i.xmt=t.xmt,n&&(t.text(n),t.caret(n.length)),n=t.text(),(r=t.caret())<=0&&(r=n.length),t.focus(),t.caret(r),t.XD=!0,-(t.umt=1)!==(o=n.lastIndexOf(",",r))&&(t.umt=o+1),n||(t.text("="),n="=",t.caret(1),r=1),"="!==n[0]&&(n="="+n,r++),i.text(n),i.caret(r),i.XD=t.XD,i.umt=t.umt,e.resumePaint())},k.prototype.startSelectMode=function(n){var n,t,n=n;n&&0!==n.indexOf("=")&&(n="="+n),(t=this).rl=!0,t.Imt=!0,(0,m.GC$)(t.jmt).css([nn,tn],[$,"no-repeat"]),t.Umt(n)},k.prototype.endSelectMode=function(){this.Imt=!1,this.Vmt(),(0,m.GC$)(this.jmt).css([nn,tn],[q,"no-repeat"])},k.prototype.Vmt=function(){var n,n,n=this.Vv;n&&(n.vCe=null),(n=this.zmt())&&(n.ol(!0,f,!0),n.repaint())},k.prototype.Ak=function(n){n&&(this.Dmt=[n])},k.prototype.Hce=function(){this.Dmt=x},k.prototype.Ymt=function(){return this.Dmt},k.prototype.destroy=function(){var n=this;n.Imt&&n.Vmt(),n.Dmt=x,n.XD=!1,n.umt=-1,n.Zmt(),n.Wmt(),n.Qmt(),(0,m.GC$)(n.Kmt).remove(),(0,m.GC$)(n.Jmt).remove(),(0,m.GC$)(n.F0).remove()},k.prototype.bind=function(n,t,i){var e=this.Ti;e&&n&&(n=n.split(/\s+/).join(o+" "),(0,m.GC$)(e).bind(n+o,t,i))},k.prototype.unbind=function(n,t){var i=this.Ti;i&&n&&(n=n.split(/\s+/).join(o+" "),(0,m.GC$)(i).unbind(n+o,t))},k.prototype.unbindAll=function(){var n=this.Ti;n&&(0,m.GC$)(n).unbind(o)},k.prototype.caret=function(n){var t,i,e,r,t=this,i=t.Ti;if(i){if(e=v.activeElement===i,r=(0,m.GC$)(i),0===arguments.length)return e?t.Xmt(i).end:r.data(S);n!==t.caret()&&(e?(t.qmt(i,n),r.data(S,t.Xmt(i).end)):r.data(S,n),t.ki(y,{}))}},k.prototype.Xmt=function(n){var t,i,e,t,t,r,t=this,i=-1,e=-1;return t.$mt(n)?(i=n.selectionStart,e=n.selectionEnd):t.vmt(n)&&0<(t=g.getSelection()).rangeCount&&((r=(t=t.getRangeAt(0)).cloneRange()).selectNodeContents(n),r.setEnd(t.endContainer,t.endOffset),e=r.toString().length,(r=t.cloneRange()).selectNodeContents(n),r.setEnd(t.startContainer,t.startOffset),i=r.toString().length,r.detach()),{start:i,end:e}},k.prototype.qmt=function(n,t){var i,t,e,i,r,i=this;i.$mt(n)?n.setSelectionRange(t,t):i.vmt(n)&&(i=this.tgt(n,t))&&(t=g.getSelection(),e=v.createRange(),(r=i.node)&&1===r.childNodes.length?e.setStart(r.firstChild,i.offset):r.lastChild&&r.lastChild.length&&e.setStart(r.lastChild,r.lastChild.length),e.collapse(!0),t.removeAllRanges(),t.addRange(e),this.rl)&&(n.parentElement.scrollTop=n.parentElement.scrollHeight)},k.prototype.text=function(n){var t,i,e,e,r,o,u,a,u,u,e,r,t=this,i=t.Ti,e=t.zmt();if(!i)return"";if(!e||e.xT)return i.innerHTML="";if(e=t.$mt(i),r=t.vmt(i),o=t.hfe(i),0===arguments.length){if(u="",e)u=i.value;else if(r){if(0<(a=i.getElementsByClassName("gcsj-func-gray-formula")).length)return"";0<=(u=(u=A?m.mt.oi(i):i.innerText).replace(/\r\n?/g,"\n")).indexOf(T)&&(u=m.mt.yi(u,T," "))}else o&&0<=(u=(u=A?m.mt.oi(i):i.innerText).replace(/\r\n?/g,"\n")).indexOf(T)&&(u=m.mt.yi(u,T," "));return u}(n=null==n?"":n)!==t.text()&&(u=t.ngt(n),t.Fmt=u?t.Ost(u):t.Ost(n),e?i.value=n:r?(u=t.egt(t.Fmt,n),t.Pmt(u),t.caret(n.length)):o?i.innerHTML=n:i.value=n,e={},(r=l.wvt.Rvt)&&r._text&&(e={sheet:r.Mf,editor:r.bvt&&r.bvt.firstChild.firstChild,canvasOffset:r.yvt}),t.ki(w,e)),t.igt&&t.rgt()},k.prototype.I6=function(){var n=this;(0,m.GC$)(n.Ti).data(E,n.text())},k.prototype.autoComplete=function(n){if(0===arguments.length)return this.ogt;this.ogt=n},k.prototype.showHelp=function(n){if(0===arguments.length)return this.agt;this.agt=n},k.prototype.add=function(n){var t,i;if(n)if(m.GC$.isArray(n))for(t=n.length,i=0;i<t;i++)this.ZP(n[i]);else this.ZP(n)},k.prototype.ZP=function(n){var t,i,e,r,o,t=n&&C(G(n.name));if(t){for(e=(i=this.ugt).length,r=0;r<e;r++){if((o=C(i[r].name))===t)return;if(t<o)break}i.splice(r,0,n)}},k.prototype.remove=function(n){var t,i,e;if(n)for(n=C(n),i=(t=this.ugt).length,e=0;e<i;e++)if(C(t[e].name)===n){t.splice(e,1);break}},k.prototype.workbook=function(n){var t=this;if(0===arguments.length)return t.Vv;n===x?t.rl&&t.Vmt():(t.Lmt(n),t.sgt())},k.prototype.Lmt=function(n){var t,i;n&&((t=this).Vv&&t.Wmt(),i=t.Ti)&&(t.Vv=n)},k.prototype.smt=function(){var n,t,i,e,r,o,u,a,s,f,n=[],t=this.Fmt,i=t&&t.length,o=0,u=0;if(0<i)for(a=0;a<i;a++)r=(e=t[a]).text,11===e.type&&(s={textOffset:o,text:r,ranges:e.ranges,index:u,allowDrag:e.allowDrag},"number"==typeof e.sheetArea&&(s.sheetArea=e.sheetArea),n.push(s),u++),o+=r.length;return(f=this.Fvt)&&n.push({ranges:[f],index:u,allowDrag:!1,isPivotClickCell:!0}),n},k.prototype.zvt=function(){var n,t,i,e,r,o,u,n=this.Ti,t=this.smt();if(n&&t&&0<t.length)for(i=this.caret(),e=t.length,o=r=void 0,u=0;u<e;u++){if((o=(r=t[u]).textOffset)<=i&&i<=o+r.text.length)return r;if(i<=o)break}return x},k.prototype.ymt=function(n){var t,i,n;return!!n&&(t=this.caret(),i=n.text,(n=n.textOffset)<=t)&&t<=n+i.length},k.prototype.pmt=function(n){var t,i,e,r,o,u,a,s,f,t=this.smt(),i=t.length;if(n<0||i<=n)return"";for(e=[],u=o=0;u<i;u++){for(r=t[u],a=!1,s=0;s<e.length;s++)if(r.text&&e[s].text.replace(/\s+/g,"").toUpperCase()===r.text.replace(/\s+/g,"").toUpperCase()){a=!0;break}if(a){if(n===u){o=s;break}}else if(e.push(r),n===u){o=e.length-1;break}}return J[o%J.length]},k.prototype.Dvt=function(){var n,t,n;return!!this.XD||!!this.rl||!!(0,m.Df)(this.text())||!!(n=this.cgt(this.caret()))&&(t=n.type,n=n.text,1===t||8===t||7===t&&"%"!==n||5===t||9===t||15===t)},k.prototype.bmt=function(n){var t,i,t;return!(!n||!this.XD)&&(t=this.umt,i=this.caret(),t<=(t=n.textOffset))&&t<i},k.prototype.fmt=function(){var n,t,i,e,r,n=[],t=this.smt(),i=t.length;if(0<i)for(r=0;r<i;r++)e=t[r],this.bmt(e)&&n.push(e);return n},k.prototype.Gvt=function(n,t,i,e,r){var o,u,u,a,s,f,i,t,t,c,i,e,a;if(void 0===r&&(r=m.SheetArea.viewport),u=(o=this).Ti,n&&u){if(!o.XD){if(!o.Dvt())return;o.XD=!(t=!1),o.umt=o.caret(),o.ki(U,{})}u=o.umt,a=o.text(),s=o.caret(),a||(a="=",s=u=o.umt=1),f=s,i&&(t=!1,a=a.substr(0,u)+(s<0?"":a.substr(s)),o.Fmt=o.Ost(a),f=s=u),i=o.cgt(s),t?(t=(t=a.substr(0,s)).substr(0,t.length-i.text.length)).length>=u&&(i.text=n,f=t.length+n.length):(t=o.Fmt,c=h.Common.Uf.hD(t,i),i=o.rl&&1<t.length&&c===t.length-1&&11===i.type,e?(n=u<s||i?a+this.fgt()+n:a.slice(0,s)+n+a.slice(s),o.Fmt=o.Ost(n)):u<s||i?(t.splice(c+1,0,{text:this.fgt(),type:8}),t.splice(c+2,0,{text:n,type:11,sheetArea:r}),n=","+n):t.splice(c+1,0,{text:n,type:11,sheetArea:r}),f=s+n.length),o.lgt(),e={},(a=l.wvt.Rvt)&&a._text&&(e={sheet:a.Mf,editor:a.bvt&&a.bvt.firstChild.firstChild,canvasOffset:a.yvt}),o.ki(w,e),o.caret(f)}},k.prototype.qD=function(){var n=this;n.XD&&(n.XD=!1,n.umt=-1,n.ki(Z,{}))},k.prototype.Nvt=function(){this.XD=!0,this.umt=this.caret()},k.prototype.Tvt=function(n){return void 0!==n&&(this.umt=n),this.umt},k.prototype.Lde=function(n,t,i){var e,r,o,u,a,s,f,c,l,e=this,r=e.Ti;if(r&&!(n<0)&&t){for(o="",u=!1,s=(a=e.Fmt)&&a.length,l=c=0;l<s;l++){if(11===(f=a[l]).type&&c++===n){a[l]={text:t,type:11,sheetArea:f.sheetArea},u=!0;break}o+=f.text}u&&(e.lgt(),e.ki(w,{}),i?e.caret(e.text().length):e.caret(o.length+t.length))}},k.prototype.sgt=function(){var n,t,t,n=this;n.Vv&&(t=n.Ti,n.Vv)&&t&&(t.setAttribute(r,"gcAttachedFormulaTextBox"),n.rl||(n.Vv.h6=n),n.Vv.D3(m.Events.FormulaTextboxEditStarted+R,n,n.hgt),n.Vv.D3(m.Events.EnterCellInternal+R,n,n.dgt),n.Vv.D3(m.Events.FormulaTextboxEditEnded+R,n,n.vgt),n.Vv.D3(m.Events.ActiveSheetChangedInternal+R,n,n.mgt),n.Vv.D3(m.Events.RangeChangedInternal+R,n,n.ggt),n.Vv.D3(m.Events.FormulaTextBoxTextChanged+R,n,n.pgt),n.Vv.D3(m.Events.FormulaTextBoxCaretChanged+R,n,n.bgt),n.Vv.D3(m.Events.ValueChanged+R,n,n.ygt),n.Vv.D3(m.Events.CellChanged+R,n,n.ygt),(t=(0,m.jf)(n.Vv))&&!n.rl&&n.text(n.wgt(t,t.ui,t.ci)),n.D3(w,n,n.Mgt),n.D3(y,n,n.Cgt))},k.prototype.refresh=function(n){var t,i,t,t=this.Vv,i=this;t&&(t=(0,m.jf)(t))&&!i.rl&&(i.rb=!!n||i.rb,i.text(i.wgt(t,t.ui,t.ci)),i.rb=!1)},k.prototype.Wmt=function(){var n=this,t=n.Vv;!n.Bmt&&t&&(n.rl||(t.h6=null,t._3(m.Events.FormulaTextboxEditStarted+R,n.hgt),t._3(m.Events.EnterCellInternal+R,n.dgt),t._3(m.Events.FormulaTextboxEditEnded+R,n.vgt),t._3(m.Events.ActiveSheetChangedInternal+R,n.mgt),t._3(m.Events.RangeChangedInternal+R,n.ggt),t._3(m.Events.FormulaTextBoxTextChanged+R,n.pgt),t._3(m.Events.FormulaTextBoxCaretChanged+R,n.bgt),t._3(m.Events.ValueChanged+R,n.ygt),t._3(m.Events.CellChanged+R,n.ygt),n._3(w,n.Mgt),n._3(y,n.Cgt)),n.text("")),n.Vv=null},k.prototype.Hmt=function(){var n,t,t,n=this;n.rb||(n.rb=!0,(t=(t=this.Vv)&&(0,m.jf)(t))&&!t.isEditing()?(n.rl||t.f6(null,t.ui,t.ci,null,null,!1,null),n.Sgt=!0):t&&1===t.Di?(t.Di=2,t._i(1,2)):n.Sgt=!1,n.rb=!1,n.Tgt)||n.w6()},k.prototype.Agt=function(){var n=this,t=n.Ti,i=n.Igt;t.insertBefore(i,t.firstChild),i.innerText=n.igt},k.prototype.xgt=function(n,t){var i;n&&this.Ngt!==t&&(this.Ngt=t,n.style.display=t?"":"none")},k.prototype.rgt=function(){var n,t,i,e,n=this,t=n.Ti,i;n.vmt(t)?((e=n.Igt)||((e=n.Igt=u("span")).className="gcsj-func-gray-formula"),n.xgt(e,!0),n.Agt()):t.placeholder=n.igt},k.prototype.kgt=function(){var n,t,i,n=this;n.igt&&(n.igt="",t=n.Ti,(i=n.vmt(t))?n.xgt(n.Igt,!1):t&&(t.placeholder=""))},k.prototype.FD=function(){var n,t,t,i,e,r,o,u,e,n=this,t=n.Vv,t=t&&(0,m.jf)(t);t&&(i=t.il,n.Sgt&&i&&(e=i.text(),cn(r=n.text(),e,!0)||(o=n.caret(),u=t.getFormulaInformation(t.getActiveRowIndex(),t.getActiveColumnIndex(),3),n.text(e),u.isArrayFormula&&(o>=r.length&&(o-=1),o=c(0,o-1)),n.caret(o))),n.Sgt&&i||n.rl)&&2!==(e=t.Di)&&(t.Di=2,t._i(e,2))},k.prototype.wgt=function(n,t,i){var e,r,r,o,o,u,e="";if(n){if(r=(r=n.parent)&&r.options,(o=n.getFormulaInformation(t,i,3))&&o.hasFormula){if(e="="+o.formulaWithCulture,o.isDynamicArray)return this.igt=e,"";this.igt="",o.isArrayFormula&&(e="{"+e+"}")}else o=n.getActualStyle(t,i),e="string"==typeof(u=n.getValue(t,i))&&(o.quotePrefix||1<u.length&&"="===u[0]&&r&&r.allowUserEditFormula&&!r.allowInvalidFormula)?"'"+u:m.mt.mi(o,u,n,{sheet:n,row:t,col:i,sheetArea:3})||"";this.kgt()}return e},k.prototype.Ove=function(){var n,t,i,i,n,e,i,t=this,i=t.Vv,i=i&&(0,m.jf)(i),n=i.ui,e=i.ci,i=i.getCellType(n,e);!1===(null==(n=null==i?void 0:i.editable)?void 0:n.call(i))&&t.mCe(!0)},k.prototype.mCe=function(n){var t,i,e,t,t=this,i=t.Ti;i&&(e=t.$mt(i),t=t.hfe(i),e?i.disabled=n:t&&(i.contentEditable=n?"false":"true"))},k.prototype.mgt=function(n,t){var n,i,e,n=n.data;n.rb||(i=t.newSheet,n.rl)||(n.rb=!0,n.close(),t&&i&&n.text(n.wgt(i,i.ui,i.ci)),n.rb=!1)},k.prototype.hgt=function(n,t){var n,i,i,i,n=n.data;n.rb||(i=(i=(i=n.Vv)&&(0,m.jf)(i))&&i.il)&&n.rl===i.rl&&n.Avt===i.Avt&&t.sheetArea!==m.SheetArea.colHeader&&t.sheetArea!==m.SheetArea.rowHeader&&(n.kgt(),n.rb=!0,n.text(i.text()),n.rb=!1)},k.prototype.dgt=function(n,t){var n=n.data;n.rl||n.rb||(n.rb=!0,t&&(n.text(n.wgt(t.sheet,t.row,t.col)),n.Ti)&&n.mCe(!!t.readonly),n.rb=!1)},k.prototype.ggt=function(n,t){var n,i,e,r,o,t,n=n.data;n.rb||n.rl||(n.rb=!0,t&&(i=t.sheet,e=t.row,r=t.col,o=t.rowCount,t=t.colCount,new m.Range(e,r,o,t).contains(i.ui,i.ci))&&n.text(n.wgt(i,i.ui,i.ci)),n.rb=!1)},k.prototype.vgt=function(n,t){var n,i,n=n.data;n.rl&&n.Imt&&n._mt?t.ignore=!0:n.rb||t.sheetArea!==m.SheetArea.colHeader&&t.sheetArea!==m.SheetArea.rowHeader&&(n.rb=!0,n.close(),(i=l.wvt.Rvt)&&i.Mf&&i.Mf!==t.sheet&&i._6(t.sheet),t&&t.sheet.il&&!t.sheet.il.rl&&!n.rl&&n.text(n.wgt(t.sheet,t.row,t.col)),n.rb=!1)},k.prototype.ygt=function(n,t){var i,e,i=t.sheet,e=i&&i.parent&&i.parent.h6;e&&e.Dgt()===t.row&&e._gt()===t.col&&e.zmt()===i&&n.data instanceof k&&("[styleinfo]"===t.propertyName&&n.data.Ove(),t.text=n.data.wgt(i,t.row,t.col),n.data.pgt(n,t))},k.prototype.pgt=function(n,t){var n,i,n=n.data;n.rb||t.sheet.il&&(n.rl!==t.sheet.il.rl||n.Avt!==t.sheet.il.Avt)||t.sheetArea===m.SheetArea.colHeader||t.sheetArea===m.SheetArea.rowHeader||(n.rb=!0,t&&(i=n.caret(),n.text(t.text),n.caret(i)),n.rb=!1)},k.prototype.bgt=function(n,t){var n=n.data;n.rb||t.sheet.il&&(n.rl!==t.sheet.il.rl||n.Avt!==t.sheet.il.Avt)||(n.rb=!0,t&&n.caret(t.caret),n.rb=!1)},k.prototype.Mgt=function(n){var n,t,t,i,e,r,o,u,r,n=n.data;if(!n.rb&&(t=(t=n.Vv)&&(0,m.jf)(t))){if(t.isEditing()||(n.Hmt(),n.focus()),n.rb=!0,i=t.ui,e=t.ci,r=t.il,o=t.getCellType(i,e),r){if(n.rl!==r.rl||n.Avt!==r.Avt)return;u=r.caret(),r.text(n.text()),r.caret(u)}else r={sheet:t,row:i,col:e,sheetArea:3},o.setEditorValue(t.li,n.text(),r);n.rb=!1}},k.prototype.Cgt=function(n){var n,t,t,t,n=n.data;n.rb||(t=(t=n.Vv)&&(0,m.jf)(t))&&t.isEditing()&&((t=t.il)&&(n.rl!==t.rl||n.Avt!==t.Avt)||(n.rb=!0,t&&(t.caret(n.caret()),n.w6()),n.rb=!1))},k.prototype.Hc=function(n){var t,i,e,e,t=this;t.Egt=!1,t.jgt=!1,t.XD=!1,t.umt=-1,t.ugt=[],t.ogt=!0,t.agt=!0,t.Ogt=!0,(i=u("div")).className="gcsj-func-ac-popup",i.style.display="none",i.setAttribute(r,"gcFuncACPopup"),n.insertBefore(i,x),t.Kmt=i,t.Tgt=!1,(e=u("div")).className="gcsj-func-help-popup",e.style.display="none",e.setAttribute(r,"gcFuncHelpPopup"),n.insertBefore(e,x),t.Jmt=e,(t.Rgt=!1,m.GC$)(i).bind("mouseover",function(){t.Ogt=!1}).bind("mouseout",function(){t.Ogt=!0}),(0,m.GC$)(e).bind("mouseover",function(){t.Ogt=!1}).bind("mouseout",function(){t.Ogt=!0}),(0,m.GC$)(i).bind("scroll",function(){t.Bgt&&clearTimeout(t.Bgt),t.Bgt=g.setTimeout(function(){t.Ti&&t.Ti.focus()},100)}),(e=u("div")).style.display="none",e.setAttribute(r,"gcFuncHelpDiv"),n.insertBefore(e,x),t.F0=e,t.Vv=null,t.rb=!1,t.Sgt=!1,t.Bmt=!1},k.prototype.Rmt=function(n){var f,c,t;n&&(c=(f=this).vmt(n),f.$mt(n)||c)&&(t=(0,m.GC$)(n),f.Ti&&f.Zmt(),f.Ti=n,i&&(i.msie||i.chrome)?c||A||i.chrome?(f.D3("focus",function(){t.data(E,f.text())}),f.D3("click",function(){t.focus()}),"input keydown keyup cut paste".split(" ").forEach(function(n){f.D3(n,function(){f.Lgt()})})):f.D3(b,function(){f.Fgt()}):f.D3(b,function(){var n;c&&(n=f.Ti.lastChild,i.chrome)&&n&&"BR"===n.tagName&&f.Ti.removeChild(n),f.Fgt()}),f.D3("keydown",function(n){var t,i,e,r,o,u,a,s,a,a,s,t=n.ctrlKey,i=n.shiftKey,e=n.altKey,r=n.metaKey,o,u=n.keyCode;t||i||e||r||!f.Tgt||(u===N?(f.Pgt(1),I(n)):u===D?(f.Pgt(-1),I(n)):u===B&&(f.Ggt(),I(n))),u===H&&f.close(),f.Ugt(n),s=(a=(0,m.jf)(f.Vv))&&a.rt.Pi(n),f.rl&&s&&(a=a.il)&&a.XD&&a.qD(),c&&(s?(8===u?P(n)&&m.di.processBackspaceAndLeftArrowKeyEvent(n,!0):46===u&&P(n)&&m.di.processDeleteAndRightArrowKeyEvent(n,!0),f.mmt()):13===u&&(t||e)?(P(n)&&In(),f.mmt(!0)):37===u?P(n)&&m.di.processBackspaceAndLeftArrowKeyEvent(n,!1):39===u&&P(n)&&m.di.processDeleteAndRightArrowKeyEvent(n,!1),c)&&t&&(90===u||89===u)&&I(n),a=f.text(),m.mt.Qf()&&c&&r&&(s=void 0,90===u)&&(i?(s=f.kmt.pop())&&(f.text(s),f.Nmt.push(a)):(s=f.Nmt.pop()||"",f.text(s),f.kmt.push(a)),n.preventDefault(),n.stopPropagation())}),f.D3("keyup",function(n){var t,i,e,n;f.Ugt(n),t=f.text(),c&&(i=void 0,e=n.keyCode,(n=n.ctrlKey)&&90===e?(i=f.Nmt.pop()||"",f.text(i),f.kmt.push(t)):n&&89===e&&(i=f.kmt.pop())&&(f.text(i),f.Nmt.push(t)))}),f.D3("focus",function(n){var t;i&&i.mozilla&&!f.Ti.innerText&&(f.Ti.innerText=""),f.Ugt(n),f.rl&&f.Imt&&(f._mt=!0,f.Umt())}),f.D3("blur",function(){f.Ogt&&f.close(),f.rl&&(f.Vmt(),f._mt=!1)}),f.D3("mousedown",function(){f._mt=!0,f.Ngt&&f.igt&&(f.kgt(),f.Hgt=!0),f.Hmt()}),f.D3("mouseup",function(){var n,t;f.Hgt&&(f.Hgt=!1,(n=f.Ti)!==(t=g.getSelection()).anchorNode)&&t.selectAllChildren(n),f.FD()}),f.D3("click",function(n){var t,t,t;f.XD&&f.qD(),(t=(t=(t=f.Vv)&&(0,m.jf)(t))&&t.il)&&t.XD&&!t.rl&&t.qD(),f.Ugt(n)}),f.D3("compositionstart",function(){f.Egt=!0}),f.D3("compositionend",function(){f.Egt=!1,(i.edge||i.chrome||i.msie)&&f.Lgt()}))},k.prototype.Zmt=function(){var n,t,t,n=this,t=n.Ti;t&&((t=(0,m.GC$)(t)).removeData(E),t.removeData(S),t.removeAttr(r),t.data(s.CONST_FORMULATEXTBOX)&&t.data(s.CONST_FORMULATEXTBOX,x),n.E3(),n.unbindAll(),n.rl&&((0,m.GC$)(n.Emt).empty(),n.Emt=x),n.Ti=x)},k.prototype.Lgt=function(){var n=this,t=(0,m.GC$)(n.Ti),i=n.text();t.data(E)!==i&&(n.Egt||t.data(E,i),n.Fgt())},k.prototype.Ugt=function(n){var t;i&&i.msie?setTimeout(function(n,t){return function(){n.zgt(n,t)}}(this,n),10):this.zgt(this,n)},k.prototype.zgt=function(n,t){var i,e,i,t,e,i,t,i=t.keyCode,e=i===_||i===Y||i===K||i===X||i===V||i===W||i===B||i===Q;n.ogt||(e=e||i===D||i===N),i=void 0!==t.button,(e||i)&&(t=n.Ti,e=(0,m.GC$)(t),(i=n.Xmt(t)).start===i.end)&&(t=i.end,e.data(S)!==t)&&(e.data(S,t),n.ki(y,{}),n.w6())},k.prototype.Dgt=function(n){var n,t,n,n=n||this.zmt();return n?(t=n.ui,(n=n.vA)?n.row:t):f},k.prototype._gt=function(n){var n,t,n,n=n||this.zmt();return n?(t=n.ci,(n=n.vA)?n.col:t):f},k.prototype.Qvt=function(n){var n,t,n,n=n||this.zmt();return n?(t=m.SheetArea.viewport,(n=n.vA)?n.sheetArea:t):f},k.prototype.zmt=function(){if(this.Vv)return(0,m.jf)(this.Vv)},k.prototype.parseInternal=function(n,t,i,e,r){var o,u,a,a;return void 0===r&&(r=m.SheetArea.viewport),o=this,u=[],(0,m.kf)(n)&&an(n,'"')%2!=1?(a=new p.Parser,a=L.Vgt(a,n,t,i,e,!0,f,f,r),u=o.Ygt(a,n)):u.push({text:n,type:17}),u},k.prototype.Ost=function(n){var t,i,e,t,i,r,t=this.Vv&&1===this.Vv.options.referenceStyle,i=l.wvt.Rvt,e=this.zmt();return t&&i&&i.Mf&&i.Mf!==e&&(e=i.Mf),t=this.Dgt(e),i=this._gt(e),r=this.Qvt(e),this.parseInternal(n,e,t,i,r)},k.prototype.Fgt=function(){var n,t,i,e,r,i,n=this,t=n.text();"\n"!==t&&0<=t.indexOf("\n")?n.ki(w,{type:b}):(i=n.Ti,e=(0,m.GC$)(i),n.jgt=!0,n.Fmt=n.Ost(t),n.vmt(i)?n.Egt||("\n"===t?(e.empty(),n.ki(w,{type:b})):(r=n.caret(),n.Pmt(n.Fmt),n.ki(w,{type:b}),n.caret(r))):n.ki(w,{type:b}),r=n.caret(),e.data(S)!==r&&(e.data(S,r),n.ki(y,{})),(i=n.zmt())&&i.ignoreShowFunctions&&i.ignoreShowFunctions()||(n.Zgt(),n.Tgt)||n.w6())},k.prototype.Wgt=function(){return h.Common.CultureManager.Fe().NumberFormat},k.prototype.Qgt=function(){var n=this.Wgt();return n&&n.arrayGroupSeperator||";"},k.prototype.Kgt=function(){var n=this.Wgt();return n&&n.arrayListSeparator||","},k.prototype.fgt=function(){var n=this.Wgt();return n&&n.listSeparator||","},k.prototype.Jgt=function(){var n=this.Wgt();return n&&n.numberDecimalSeparator||"."},k.prototype.Ygt=function(n,t){for(var i,e,r,o,u,a,s,f,c,l,g,g,i=[],e=[],r=t&&"="!==t[0],o=this.Qgt(),u=this.Kgt(),a=!1,s=0;s<n.length;s++)0<s&&s<n.length-1&&";"===n[s-1].text&&","===n[s].text&&"ARRAYROW"===n[s+1].text||(f=n[s],c=this.Xgt(f,e),l=f.text,2===c?i.push({text:l,type:c}):a&&8===c&&","===l?i.push({text:u,type:9}):a&&8===c&&";"===l?i.push({text:o,type:10}):8===c?i.push({text:l,type:c}):3===c?("ARRAY"===l&&(a=!0),i.push({text:"{",type:3})):4===c?"ARRAY"===l||"}"===l?(a=!1,i.push({text:"}",type:4})):i.push({text:l,type:4}):6===c?i.push({text:")",type:c}):13===c?i.push({text:h.Common.st.Ge(l),type:c,ranges:f.ranges,allowDrag:f.canDrag}):1===c&&r||null!==c&&(11===c&&n[s+1]&&"#"===n[s+1].text&&f.ranges&&0<f.ranges.length?(g=new p.CalcReference(this.zmt().qgt,f.ranges).getSpillRef())&&g.$gt&&(s++,f.ranges=g.$gt,l+="#"):11===c&&l.length===f.endIndex-f.index&&"!"===t[f.endIndex]&&(l+="!"),g={text:l,type:c,ranges:f.ranges,allowDrag:f.canDrag},11===c&&(g.sheetArea=f.sheetArea),i.push(g)));return i},k.prototype.Xgt=function(n,t){var i,e,r,n,r,i=n.type,e=n.subType,r=n.text,n=n.value;if(1===i){if(1===e)return"ARRAY"===r||"ARRAYROW"===r?(t.push(3),3):(t.push(5),"@"===n||"("===n.trim()?5:2);if(2===e){if(")"===n.trim())return 6;if(0<t.length){if(3===(r=t[t.length-1]))return t.pop(),4;if(5===r)return t.pop(),6}}if("="===n.trim())return 1}else if(3===i){if(0===e)return 8}else{if(5===i||6===i||4===i)return 7;if(0===i)return 7===e||0===e||12===e?11:5===e?12:4===e?13:3!==e&&6===e?16:14;if(7===i)return 15;if(8===i);}return 17},k.prototype.lgt=function(){for(var n,t,i,e,r,o,n=this,t=n.Ti,i=n.Fmt,e="",r=i&&i.length,o=0;o<r;o++)e+=i[o].text;n.$mt(t)?t.value=e:n.vmt(t)&&n.Pmt(i)},k.prototype.$mt=function(n){var n=n&&n.tagName;return"TEXTAREA"===n||"INPUT"===n},k.prototype.vmt=function(n){return n&&"DIV"===n.tagName&&"true"===n.contentEditable},k.prototype.hfe=function(n){return n&&"DIV"===n.tagName},k.prototype.t2t=function(n){return"gcEditingInput"===(0,m.GC$)(n).attr(r)},k.prototype.D3=function(n,t,i){var e=this.Ti;e&&n&&(n=n.split(/\s+/).join(R+" "),(0,m.GC$)(e).bind(n+R,t,i))},k.prototype._3=function(n,t){var i=this.Ti;i&&n&&(n=n.split(/\s+/).join(R+" "),(0,m.GC$)(i).unbind(n+R,t))},k.prototype.E3=function(){var n=this.Ti;n&&(0,m.GC$)(n).unbind(R)},k.prototype.ki=function(n,t){var i=this.Ti;i&&(0,m.GC$)(i).trigger(n,t)},k.prototype.cgt=function(n){var t,i,e,r,o;if(!(n<=0)&&0<(i=(t=this.Fmt)&&t.length))for(r=void(e=0),o=0;o<i;o++)if(n<=(e+=(r=t[o]).text.length))return r;return x},k.prototype.n2t=function(){var n,t,i,e,r,e,o,n=this.Vv;if(n&&(t=(0,m.jf)(n))&&(i=t.getCalcService().allowDynamicArray,e=t.il)){for(r=[].concat(e.ugt),m.Worksheet.et(t,"getAllFunctions",e={funcs:r}),o=(r=e.funcs).length-1;0<=o;o--)!i&&r[o]&&dn(r[o].name)?r.splice(o,1):r[o].isFunc=!0;return r.concat(this.e2t(n,t)).concat(this.i2t(n.sheets)).concat(this.r2t(n))}return this.ugt},k.prototype.e2t=function(n,t){var i,t,t,i=[],t=t.getCustomNames();return t&&m.GC$.each(t,function(n,t){i.push({name:t.Zc,description:t.TZ})}),(t=n.getCustomNames())&&m.GC$.each(t,function(n,t){i.push({name:t.Zc,description:t.TZ})}),i},k.prototype.i2t=function(n){var e=[];return n.forEach(function(n){var n,t,i,n=n.tables;if(n&&(t=n.all()))for(i=0;i<t.length;i++)e.push({name:t[i].name(),description:p.sR().Fbx_TableName_Description+t[i].name()})}),e},k.prototype.r2t=function(n){for(var t,i,e,t=[],i=n.mp,e=0;e<i.length;e++)t.push({name:i[e].name(),description:p.sR().Fbx_TableSheetName_Description+i[e].name()});return t},k.prototype.o2t=function(n,t){var i,e,r,o;for(n=C(n),d.OS(n,"[")&&(n=n.substr(n.lastIndexOf("[")+1),n=d.Vi(n,"@","")),i=[],e=t&&t.length,o=0;o<e;o++)r=t[o],0===C(G(r.name)).indexOf(n)&&i.push(r);return i},k.prototype.a2t=function(){var n,t,i,e,r,o,n=this.caret();if(!(n<=0)&&0<(i=(t=this.Fmt)&&t.length))for(r=void(e=0),o=0;o<i;o++){if(e+(r=t[o]).text.length>=n)return r.text.substring(0,n-e);e+=r.text.length}return""},k.prototype.u2t=function(){for(var n,t,i,e,r,o,u,a,s,f,c,l,g,h,n=this.caret(),t=this.Fmt,i=t&&t.length,e=[],r=0,u=0;u<i;u++){if(o=t[u],e.push(o),6===o.type)for(a=0;0<e.length;)if(6===(s=e.pop()).type&&a++,5===s.type&&a--,0===a){0<e.length&&(s=e[e.length-1])&&2===s.type&&e.pop();break}if(n<=(r+=o.text.length))break}if(0<e.length)for(f=0;0<e.length;)if(8===(o=e.pop()).type)f++;else if(2===o.type){for(c=C(o.text),g=(l=this.n2t())&&l.length,h=void 0,u=0;u<g;u++)if(h=l[u],C(G(h.name))===c)return{func:h,activeParamterIndex:f,isFunc:h.isFunc};break}return x},k.prototype.Zgt=function(){var t,n,i,e,r,o,u,a,e,s,f,t=this,n=t.s2t(),i;if(!(t.ogt&&(0,m.kf)(t.text())&&n&&0<n.length&&(!t.XD||t.Lve)&&!t.Egt)||t.rl&&!t.Lve)t.f2t();else{for(t.c2t(),e=t.Kmt,8<n.length?(e.style.height="204px",e.style.overflowY="scroll"):(e.style.height="auto",e.style.overflowY=""),r="",o=n.length,u=void 0,a=0;a<o;a++)r+="<div class='gcsj-func-ac-row'><div class='gcsj-func-ac-row-name' isFunc="+(u=n[a]).isFunc+">"+G(u.name)+"</div><div class='gcsj-func-ac-row-description'>"+(u.description||"")+"</div></div>";(e=(0,m.GC$)(t.Kmt)).html(r).show(),t.Tgt=!0,0<(s=e.find(j)).length&&(f="gcsj-ac-row-active",(0,m.GC$)(s[0]).addClass(f),s.bind("mouseover",function(){s.removeClass(f),(0,m.GC$)(this).addClass(f)}),s.bind("click",function(){t.Ggt()}),t.Ngi)&&s.bind("mousedown",function(n){t.Ggt(),I(n)}),t.u_()}},k.prototype.Qmt=function(){var n,t,n=this,t=(0,m.GC$)(n.Kmt).find(j);t&&(t.unbind("mouseover"),t.unbind("click"),n.Ngi)&&t.unbind("mousedown")},k.prototype.s2t=function(){var n,t,i,e,r,t,r,o,u,a,s,f,t,n=this,t=n.cgt(n.caret()),i=t&&t.text,e=[],r=n.Fmt.indexOf(t);if(t&&14===t.type)return e;if(t=this._getTable(r),0<(r=n.h2t(r,t)).length){if(o=[],!t.Mf.NMi)for(s in u=JSON.parse(JSON.stringify(p.sR().d2t)),a=p.getMapping()&&p.getMapping().tableFunctionsMapping,u)(f=a&&a[u[s].name])&&(u[s].name=f),o.push(u[s]);if(e=e.concat(r).concat(o),d.dT(i,"[")||d.dT(i,"[@"))return e}else e=this.n2t();return t=[],t=(i=n.a2t())?n.o2t(i,e):t},k.prototype._getTable=function(n){var t,i,e,t,n,t,e,t,t=this.Fmt;return!(n<0||!t||n>=t.length)&&(e=(i=this.Vv)&&(0,m.jf)(i),a(n)&&(n=t.length),e)?(t=t[n],n=d.gmt(t.text,"["),e=(t=e.tables)&&t.findByName(n),a(e)&&(t=i.getSheetTab(n))&&t._gi===m.SheetType.tableSheet?t:e):null},k.prototype.h2t=function(n,t){var i=[];return i=a(t)?i:ln(t).columns},k.prototype.f2t=function(){(0,m.GC$)(this.Kmt).hide(),this.Tgt=!1},k.prototype.Pgt=function(n){var t,i,e,r,o,u,a,s,t=(0,m.GC$)(this.Kmt).find(j),i=t.length;if(0!==i){if(e="gcsj-ac-row-active",r=0,n)for(o=0;o<i;o++)if((0,m.GC$)(t[o]).hasClass(e)){r=o+n;break}u=(0,m.GC$)(this.Kmt).scrollTop(),t.removeClass(e),(a=0)<i&&(a=t[0].offsetHeight),r=c(r,0),s=t[r=F(r,i-1)],(0,m.GC$)(s).addClass(e),s.offsetTop+s.offsetHeight>(0,m.GC$)(this.Kmt).scrollTop()+(0,m.GC$)(this.Kmt).height()?(0,m.GC$)(this.Kmt).scrollTop((0,m.GC$)(this.Kmt).scrollTop()+a):s.offsetTop<(0,m.GC$)(this.Kmt).scrollTop()?(0,m.GC$)(this.Kmt).scrollTop(s.offsetTop):(0,m.GC$)(this.Kmt).scrollTop(u)}},k.prototype.Ggt=function(){var n,t,i,t,e,r,o,u,a,s,f,c,l,g,h,h,l,c,h,n=this,t=(0,m.GC$)(n.Kmt).find(".gcsj-ac-row-active .gcsj-func-ac-row-name"),i=t.text(),t="true"===t.attr("isFunc");if(i){for(e=n.caret(),o=(r=n.Fmt)&&r.length,s=a=u=0,f=x;s<o&&!(e<=u+(a=(f=r[s]).text.length));)s++,u+=a;c=e-u,l=f.text,h=g=0,d.OS(l,"[")?-1===(g=l.lastIndexOf("[",c-1))?(g=l.indexOf("["),f.text=-1===g?i:i+l.substr(g),g=0):("@"===l.charAt(++g)&&(g+=1),-1===(h=l.indexOf("]",c))&&(h=l.length),f.text=l.substring(0,g)+i+l.substr(h)):(f.text=i,(h=l.substr(c))&&1<(l=n.Ost("="+h)).length&&r.splice(s+1,0,l[1])),f.type=t?2:11,h=r[c=s+1],!t||h&&5===h.type||r.splice(c,0,{text:"(",type:5}),n.f2t(),n.Ti.focus(),n.lgt(),n.caret(u+i.length+g+(t?1:0)),n.w6(),n.Fmt=n.Ost(n.text()),n.ki(w,{})}},k.prototype.w6=function(){var n,t,t,i,e,r,o,u,a,s,f,c,l,g,h,v,d,I,t,n=this,t=n.zmt();if(!(t&&t.ignoreShowFunctions&&t.ignoreShowFunctions()))if(n.Tgt&&n.f2t(),(t=n.u2t())===x||!0!==t.isFunc)n.c2t();else if(i=n.fgt(),!(e=n.agt&&(0,m.kf)(n.text())&&t&&!n.XD&&!n.Egt)||n.rl&&!n.Lve)n.c2t();else{for(u=(o=(r=t.func).parameters)&&o.length,a=F(u-1,t.activeParamterIndex),s=void 0,f="",c=0;c<u;c++)l=(s=o[c]).name,s.repeatable&&(l+=i+"..."),s.optional&&(l="["+l+"]"),g=c===u-1?"":i+" ",f+=l=c===a?"<span class='gcsj-func-help-paramter gcsj-func-help-paramter-active'>"+l+"</span>"+g:"<span class='gcsj-func-help-paramter'>"+l+"</span>"+g;t=(h="<div class='gcsj-func-help-title'><div class='gcsj-func-help-formula'><span class='gcsj-func-help-formula-name'>"+G(r.name)+"</span><span class='gcsj-func-help-paramter-paren'>(</span>"+f+"<span class='gcsj-func-help-paramter-paren'>)</span></div></div>")+(I="<div class='gcsj-func-help-body'>"+(d="<div class='gcsj-func-help-section-content'>"+(v="<div class='gcsj-func-help-section'><div class='gcsj-func-help-section-title'>"+p.sR().Fbx_Summary+"</div><div class='gcsj-func-help-section-content'>"+(r.description||"")+"</div></div>")+"</div>")+"</div>"),(0,m.GC$)(n.Jmt).html(t).show(),n.Rgt=!0,n.u_()}},k.prototype.c2t=function(){(0,m.GC$)(this.Jmt).hide(),this.Rgt=!1},k.prototype.close=function(){this.f2t(),this.c2t()},k.prototype.$D=function(n,t){var i,e,r,o,u,a,i=n.ctrlKey||n.shiftKey||n.altKey||n.metaKey,e=n.keyCode,r=n.ctrlKey,o=n.altKey,u=n.metaKey,a=n.srcElement||n.target;return n.target===this.Ti&&(46===e||8===e)||!this.XD&&(!(!this.Tgt||i||e!==N&&e!==D&&e!==B)||!!(a&&t&&t.isEditing&&"gcAttachedFormulaTextBox"===a.getAttribute("gcUIElement"))&&(67===e&&(r||u)&&!o||88===e&&(r||u)&&!o))},k.prototype.u_=function(){var n,t,i,t,e,r,n,o,o,e,i,r,u,a,n,s,i,n=this,t=x;n.Tgt?t=n.Kmt:n.Rgt&&(t=n.Jmt),t&&(n.Zpe?n.Wpe(t):(i=(0,m.GC$)(n.Ti),t=(0,m.GC$)(t),e=i.parent(),r=i.outerHeight(),n.t2t(n.Ti)&&(r=(e=e.parent()).outerHeight()),n=e.css("top"),o=parseFloat(n),isNaN(o)||(n=o),o=e.css("left"),"auto"===n&&(n=i.offset().top,o=i.offset().left),e=n+r,i=(0,m.GC$)(v.body).outerHeight(),r=(0,m.GC$)(v.body).outerWidth(!0),u=t.outerHeight(),a=t[0].offsetWidth,i<(s=e+u)&&0<=(i=n-u)&&(e=i),r<(n=parseFloat(o))+a+2&&(n-=n+a+2-r),t.css("top",e).css("left",n)))},k.prototype.Wpe=function(n){var t,i,e,i,r,o,t,u,a,s,t,r,t,t=this,i=n.getBoundingClientRect(),e=i.height,i=i.width,r=v.body.clientHeight,o=v.body.clientWidth,t=t.Ti.getBoundingClientRect(),u=t.left,a=t.top,s=t.width,t=t.height;n.style.position="fixed",r<(r=a+t)+e&&0<=a-e&&(r=a-e),o<(t=u)+i&&0<=u+s-i&&(t=u+s-i),(0,m.GC$)(n).css("top",r).css("left",t)},k.prototype.focus=function(){(0,m.GC$)(this.Ti).focus()},k.prototype.Pmt=function(n){for(var t,i,e,r,o,u,a,s,f,t=this,i="",e="",r=n&&n.length,o=0,a=0;a<r;a++)s="",11===(u=n[a]).type&&(s=" style='color: "+t.pmt(o)+"'",o++),t.F0.innerText=u.text,i+="<span"+s+" class='gcsj-func-color-text'>"+t.F0.innerHTML+"</span>",e+=u.text;if(e||t.text())if(f=t.Ti,i)f.innerHTML="<span class='gcsj-func-color-content'>"+i+"</span>";else for(;f.firstChild;)f.removeChild(f.firstChild)},k.prototype.tgt=function(n,t){var i,e,r,o,u,i=(0,m.GC$)(n).find(".gcsj-func-color-content .gcsj-func-color-text"),e=i.length;for(t=c(0,t),u=0;u<e;u++)if((t-=(o=(r=i[u]).innerText).length)<=0)return{node:r,offset:o.length+t};return o?{node:r,offset:o.length}:x},k.prototype.y6=function(n,t){var i,e,r,i=g.getSelection(),e=this.Ti.children[0],r=document.createRange();r.setStart(e,n),r.setEnd(e,t),i.removeAllRanges(),i.addRange(r)},k.prototype.mmt=function(n){var t,i,i,e,t=this,i=t.Ti,i=t.vmt(i),e=t.text();i&&e&&(e=n?e.substr(0,e.length-2):e,t.Nmt.push(e))},k.prototype.egt=function(n,t){var i,e,r,o,u,a,s,f;if(t)for(o=t.length,u=r=e=i=0;u<n.length;u++){for(a=n[u].text;e<o;e++)if((s=t[e].toUpperCase())===(f=a[r]?a[r].toUpperCase():void 0))r+=1;else{if("\n"!==s)break;e+1<o&&t[e+1]===O&&(e+=1)}n[u].text=t.substring(i,e),i=e,r=0}return n},k.prototype.ngt=function(n){var t,i,e,r,o;if("="===n[0]&&-1!==n.indexOf("\n")){for(i=n.length,e=!(t=[]),r=0;r<i;r++)(e='"'===(o=n[r])?!e:e)||"\n"!==o?t.push(o):r+1<i&&n[r+1]===O&&(r+=1);return t.join("")}},k.prototype.isOutFormulaTextBox=function(n){if(0===arguments.length)return this.Ngi;this.Ngi=n},un=k,s.FormulaTextBox=un},Common:function(n){n.exports=GC.Spread},CalcEngine:function(n){n.exports=GC.Spread.CalcEngine},Core:function(n){n.exports=GC.Spread.Sheets},SheetsCalc:function(n){n.exports=GC.Spread.Sheets.CalcEngine}},e={},n=r("./dist/plugins/formulaTextbox/formulaTextBox.entry.js"),(((GC=void 0===GC?{}:GC).Spread=GC.Spread||{}).Sheets=GC.Spread.Sheets||{}).FormulaTextBox=n}();