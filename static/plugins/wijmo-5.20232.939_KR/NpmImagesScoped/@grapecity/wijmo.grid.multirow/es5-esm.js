/*!
    *
    * Wijmo Library 5.20232.939
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++){t=arguments[o];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)};import{ObservableArray,NotifyCollectionChangedEventArgs,assert,asBoolean,copy,isArray,toHeaderCase,getType,isIE,asInt,Key,addClass,createElement,hasItems,asArray,toggleClass,isFunction,isString,isBoolean,Event,CancelEventArgs,CollectionViewGroup,NotifyCollectionChangedAction,_registerModule}from"@grapecity/wijmo";import{Row,GroupRow,CellRange,RowColFlags,CellRangeEventArgs,Column,ColumnCollection,CellType,FlexGrid,_AddNewHandler,_NewRowTemplate,SelMove,_SelectionHandler,_EditHandler,SelectionMode,AllowDragging,MergeManager}from"@grapecity/wijmo.grid";import*as selfModule from"@grapecity/wijmo.grid.multirow";var _MultiRowSelectionHandler=function(e){__extends(_MultiRowSelectionHandler,e);function _MultiRowSelectionHandler(){return null!==e&&e.apply(this,arguments)||this}_MultiRowSelectionHandler.prototype._getNextColumnCell=function(t,o,r,n){void 0===n&&(n=0);var l=this._g,i=l.cells,a=l.columns,s=SelMove;switch(r){case s.NextEditableCell:for(var u=o+1;u<a.length;u++){if((c=l._getBindingColumn(i,t,a[u])).renderSize>0&&!c.isReadOnly)return u}return o;case s.PrevEditableCell:for(u=o-1;u>=0;u--){var c;if((c=l._getBindingColumn(i,t,a[u])).renderSize>0&&!c.isReadOnly)return u}return o}return e.prototype._getNextColumnCell.call(this,t,o,r,n)};return _MultiRowSelectionHandler}(_SelectionHandler);export{_MultiRowSelectionHandler};var _MultiRow=function(e){__extends(_MultiRow,e);function _MultiRow(t,o,r){var n=e.call(this,t)||this;n._idxData=o;n._idxRecord=r;return n}Object.defineProperty(_MultiRow.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});return _MultiRow}(Row);export{_MultiRow};var _MultiGroupRow=function(e){__extends(_MultiGroupRow,e);function _MultiGroupRow(t,o){var r=e.call(this,t)||this;r._idxRecord=o;return r}Object.defineProperty(_MultiGroupRow.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});Object.defineProperty(_MultiGroupRow.prototype,"hasChildren",{get:function(){return!0},enumerable:!0,configurable:!0});_MultiGroupRow.prototype.getCellRange=function(){var t=this._getLastRowInHeader();return t!=this?t.getCellRange():e.prototype.getCellRange.call(this)};Object.defineProperty(_MultiGroupRow.prototype,"isCollapsed",{get:function(){return this._getLastRowInHeader()._getFlag(RowColFlags.Collapsed)},set:function(e){var t=this._getLastRowInHeader();e!=t.isCollapsed&&null!=t._list&&t._setCollapsed(asBoolean(e))},enumerable:!0,configurable:!0});_MultiGroupRow.prototype._setCollapsed=function(e){var t=this,o=this.grid,r=o.rows,n=this.getCellRange(),l=new CellRangeEventArgs(o.cells,new CellRange(this.index,-1));if(o.onGroupCollapsedChanging(l)){o.deferUpdate((function(){r.deferUpdate((function(){t._setFlag(RowColFlags.Collapsed,e,!0);for(var o=n.topRow+1;o<=n.bottomRow&&o>-1&&o<r.length;o++){r[o]._setFlag(RowColFlags.ParentCollapsed,e,!0);var l=r[o];if(l instanceof _MultiGroupRow){var i=l._getLastRowInHeader();for(o+=1;o<=i.index;o++)(l=r[o])._setFlag(RowColFlags.ParentCollapsed,e,!0);o--}l instanceof GroupRow&&l.isCollapsed&&(o=l.getCellRange().bottomRow)}}))}));o.onGroupCollapsedChanged(l)}};_MultiGroupRow.prototype._getLastRowInHeader=function(){var e=this.grid,t=this;if(e&&e.multiRowGroupHeaders)for(var o=e.rows,r=this.dataItem,n=this.index+1;n<o.length&&o[n].dataItem==r;n++)t=o[n];assert(t instanceof _MultiGroupRow,"last row in header should be a _MultiRowGroup");return t};return _MultiGroupRow}(GroupRow);export{_MultiGroupRow};var _MultiRowEditHandler=function(e){__extends(_MultiRowEditHandler,e);function _MultiRowEditHandler(){return null!==e&&e.apply(this,arguments)||this}_MultiRowEditHandler.prototype._selectionChanging=function(e){var t=this;if(this.finishEditing()){var o=this._g._selHdl.selection.row;if(o!=e.row){var r=this._g.rows.length;if((o>-1&&o<r?this._g.rows[o].dataItem:null)!=(e.row>-1&&e.row<r?this._g.rows[e.row].dataItem:null)){this._commitRowEdits();if(this._g._getHasValidation()&&this._g.validateEdits){var n=!this._g.rows[o]||this._g.rows[o]&&Object.getPrototypeOf(this._g.rows[o])!==_MultiRow.prototype?null:this._g.getEmptyRequiredCell(o);null!==n&&setTimeout((function(){t._g.select(n);t.startEditing(!0,n.row,n.col,!0,e)}))}}}}else e.cancel=!0};return _MultiRowEditHandler}(_EditHandler);export{_MultiRowEditHandler};var MultiRowCellCollection=function(e){__extends(MultiRowCellCollection,e);function MultiRowCellCollection(){return null!==e&&e.apply(this,arguments)||this}MultiRowCellCollection.prototype._setLayout=function(e){this._layout=e;this.forEach((function(t){return t._setLayout(e)}))};MultiRowCellCollection.prototype.onCollectionChanged=function(t){void 0===t&&(t=NotifyCollectionChangedEventArgs.reset);var o=this._layout;o&&o._onLayoutChanged();e.prototype.onCollectionChanged.call(this,t)};return MultiRowCellCollection}(ObservableArray);export{MultiRowCellCollection};var _MultiRowLayout=function(){function _MultiRowLayout(e,t,o){this._initialized=!1;this._disposed=!1;this._rowsPerItem=1;this._groupsByColumn={};this._grid=e;this._changeCallback=o;this._bindingGroups=this._parseCellGroups(t);this._initialized=!0}_MultiRowLayout.prototype._dispose=function(){if(!this._disposed){this._disposed=!0;var e=this._bindingGroups;e.forEach((function(e){e.cells._setLayout(null)}));e._setLayout(null);this._bindingGroups=null}};_MultiRowLayout.prototype._onLayoutChanged=function(){this._initialized&&!this._disposed&&this._changeCallback&&this._changeCallback()};_MultiRowLayout.prototype._parseCellGroups=function(e){var t=this,o=this._grid,r=null,n=1;if(e){if(e instanceof MultiRowCellCollection){e.forEach((function(e){assert(e instanceof MultiRowCellGroup,"groups contain items of invalid type")}));r=e}else{r=new MultiRowCellCollection;for(var l=0;l<e.length;l++){var i=null;i=e[l]instanceof MultiRowCellGroup?e[l]:new MultiRowCellGroup(e[l]);r.push(i)}}r.forEach((function(e){e.openGroup()}));l=0;for(var a=0;l<r.length;l++){(i=r[l])._colstart=a;a+=i._colspanEff;n=Math.max(n,i._rowspanEff)}r.forEach((function(e){e.closeGroup(o,n)}));this._rowsPerItem=n}else r=new MultiRowCellCollection;this._multiRowGroupHeaderRange=this._getMultiRowGroupHeaderRange(r);r.forEach((function(e){e.cells._setLayout(t)}));r._setLayout(this);return r};_MultiRowLayout.prototype._getMultiRowGroupHeaderRange=function(e){for(var t=this._rowsPerItem,o=new CellRange(0,0,t-1,0),r=0;r<e.length;r++){var n=e[r];if(n._hasAggregates){0===r&&this._expandMultiRowGroupHeaderToAggregate(o,n);return o}o.col2=n._colstart+n._colspanEff-1}return o};_MultiRowLayout.prototype._expandMultiRowGroupHeaderToAggregate=function(e,t){var o=this._rowsPerItem,r=t._colspanEff,n=t.cells.filter((function(e){return e.col>0&&0!=e.aggregate})).map((function(e){return e.col})).reduce((function(e,t){return t<e?t:e}),r);e.col2=Math.max(t._colstart+n-1,e.col2);for(var l=n;l<r;l++){for(var i=!0,a=0;a<o;a++){var s=t._getCellRange(a,l);i=i&&s.col===l}if(i){e.col2=Math.max(t._colstart+l-1,e.col2);return}}};_MultiRowLayout.prototype._getSingleRowGroupHeaderRange=function(e,t,o){var r=this._bindingGroups;if(0===r.length)return null;var n=this._getGroupByColumn(o);assert(null!=n,"Failed to get the group!");var l=n._getCellRange(0,o-n._colstart),i=new CellRange(t,n._colstart+l.col,t,n._colstart+l.col2);if(0!=n.getBindingColumn(e,t,o).aggregate)return i;for(var a=r[0]._colstart,s=o-1;s>=a;s--){var u=this._getGroupByColumn(s);assert(null!=u,"Failed to get the group!");if(0!=u.getBindingColumn(e,t,s).aggregate)break;l=u._getCellRange(0,s-u._colstart);i.col=u._colstart+l.col}var c=r[r.length-1],p=c._colstart+c._colspanEff;for(s=o+1;s<p;s++){var d=this._getGroupByColumn(s);assert(null!=d,"Failed to get the group!");if(0!=d.getBindingColumn(e,t,s).aggregate)break;l=d._getCellRange(0,s-d._colstart);i.col2=d._colstart+l.col2}return i};_MultiRowLayout.prototype._getGroupHeaderMergedRange=function(e,t,o,r){if(r){var n=this._multiRowGroupHeaderRange;if(n.containsColumn(o)){var l=this._rowsPerItem,i=Math.floor(t/l)*l;return new CellRange(i+n.row,n.col,i+n.row2,n.col2)}var a=this._getGroupByColumn(o);assert(a instanceof MultiRowCellGroup,"Failed to get the group!");return a.getMergedRange(e,t,o)}return this._getSingleRowGroupHeaderRange(e,t,o)};_MultiRowLayout.prototype._getGroupByColumn=function(e){var t=this._groupsByColumn[e];if(!t)for(var o=this._bindingGroups,r=0;r<o.length;r++)if(e>=(t=o[r])._colstart&&e<=t._colstart+t._colspanEff-1){this._groupsByColumn[e]=t;break}return t};_MultiRowLayout.prototype._updateCellTypes=function(e){this._bindingGroups.forEach((function(t){t._cols.forEach((function(t){null==t.dataType&&t._binding&&(t.dataType=getType(t._binding.getValue(e)));if(!t.isReadOnly){var o=isIE()?null:Object.getOwnPropertyDescriptor(e,t.binding);t.isReadOnly=o&&!o.writable&&!o.set}}))}))};return _MultiRowLayout}();export{_MultiRowLayout};var MultiRowCell=function(e){__extends(MultiRowCell,e);function MultiRowCell(t){var o=e.call(this)||this;o._row=o._col=0;o._rowspan=o._colspan=1;copy(o,t);return o}Object.defineProperty(MultiRowCell.prototype,"row",{get:function(){return this._row},set:function(e){var t=asInt(e,!1,!0);if(this._row!=t){this._row=t;this._onLayoutPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRowCell.prototype,"col",{get:function(){return this._col},set:function(e){var t=asInt(e,!1,!0);if(this._col!=t){this._col=t;this._onLayoutPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRowCell.prototype,"colspan",{get:function(){return this._colspan},set:function(e){var t=asInt(e,!1,!0);assert(t>0,"colspan must be >= 1");if(this._colspan!=t){this._colspan=t;this._onLayoutPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRowCell.prototype,"rowspan",{get:function(){return this._rowspan},set:function(e){var t=asInt(e,!1,!0);assert(t>0,"rowspan must be >= 1");if(this._rowspan!=t){this._rowspan=t;this._onLayoutPropertyChanged()}},enumerable:!0,configurable:!0});MultiRowCell.prototype._setLayout=function(e){this._layout=e};MultiRowCell.prototype._onLayoutPropertyChanged=function(){var e=this._layout;e&&e._onLayoutChanged()};return MultiRowCell}(Column);export{MultiRowCell};var MultiRowCellGroup=function(e){__extends(MultiRowCellGroup,e);function MultiRowCellGroup(t){var o=e.call(this)||this;o._isRowHeader=!1;o._colstart=0;o._cells=new MultiRowCellCollection;copy(o,t);return o}MultiRowCellGroup.prototype._copy=function(e,t){if("cells"==e){isArray(t)&&(this._cellsDef=t);return!0}return!1};Object.defineProperty(MultiRowCellGroup.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0});Object.defineProperty(MultiRowCellGroup.prototype,"isRowHeader",{get:function(){return this._isRowHeader},set:function(e){var t=asBoolean(e);if(this._isRowHeader!=t){this._isRowHeader=t;this._onLayoutPropertyChanged()}},enumerable:!0,configurable:!0});MultiRowCellGroup.prototype.openGroup=function(){if(!this._isParsed){this._cells=this._parseCells(this._cellsDef);this._isParsed=!0}this._calculate()};MultiRowCellGroup.prototype.closeGroup=function(e,t){var o=this;if(t>this._rowspanEff){this._cells.forEach((function(e){e.row==o._rowspanEff-1&&(e._rowspanEff=t-e.row)}));this._rowspanEff=t}this._cells.forEach((function(e){for(;e.col+e._colspanEff<o._colspanEff&&!o._slotTaken(e.row,e.col+e._colspanEff);)e._colspanEff++}));this._cells.forEach((function(e){for(;e.row+e._rowspanEff<o._rowspanEff&&!o._slotTaken(e.row+e._rowspanEff,e.col);)e._rowspanEff++}));if(this._cells.length>0)for(var r=0;r<this._rowspanEff;r++)for(var n=0;n<this._colspanEff;n++)assert(this._slotTaken(r,n),"Invalid layout (empty cells).");this._cols=new ColumnCollection(e,e.columns.defaultSize);this._rng=new Array(t*this._colspanEff);this._cells.forEach((function(e){for(var t=0;t<e._rowspanEff;t++)for(var r=0;r<e._colspanEff;r++){var n=(e.row+t)*o._colspanEff+e.col+r;o._cols.setAt(n,e);var l=new CellRange(0-t,0-r,0-t+e._rowspanEff-1,0-r+e._colspanEff-1);l.isSingleCell||(o._rng[n]=l)}}));var l=this._colstart;this._rng[-1]=new CellRange(0,l,0,l+this._colspanEff-1);this._hasAggregates=!1;for(var i=0;i<this._cells.length&&!this._hasAggregates;i++)this._hasAggregates=0!=this._cells[i].aggregate};MultiRowCellGroup.prototype.getColumnWidth=function(e){for(var t=0;t<this._cells.length;t++){var o=this._cells[t];if(o.col==e&&1==o._colspanEff)return o.width}return null};MultiRowCellGroup.prototype.getMergedRange=function(e,t,o){if(t<0)return this._rng[-1];var r=e.rows[t],n=null!=r.recordIndex?r.recordIndex:t%this._rowspanEff,l=o-this._colstart,i=this._rng[n*this._colspanEff+l];e.cellType==CellType.ColumnHeader&&t++;return i?new CellRange(t+i.row,o+i.col,t+i.row2,o+i.col2):null};MultiRowCellGroup.prototype.getBindingColumn=function(e,t,o){if(t<0)return this;var r=e.rows[t],n=r&&null!=r.recordIndex?r.recordIndex:t%this._rowspanEff,l=o-this._colstart;return this._cols[n*this._colspanEff+l]};MultiRowCellGroup.prototype.getColumn=function(e){return this._cols.getColumn(e)};MultiRowCellGroup.prototype._getCellRange=function(e,t){var o=this._rng[e*this._colspanEff+t];return o?new CellRange(e+o.row,t+o.col,e+o.row2,t+o.col2):new CellRange(e,t)};MultiRowCellGroup.prototype._parseCells=function(e){var t=this._cells;if(e){if(e instanceof MultiRowCellCollection){e.forEach((function(e){assert(e instanceof MultiRowCell,"cells contain items of invalid type")}));t=e}else e.forEach((function(e){var o=null;o=e instanceof MultiRowCell?e:new MultiRowCell(e);t.push(o)}));t.forEach((function(e){e.binding&&!e.header&&(e.header=toHeaderCase(e.binding))}))}return t};MultiRowCellGroup.prototype._clearCalculations=function(){this._colstart=0;this._cols=null;this._hasAggregates=!1;this._rng=null;this.row=0;this.col=0;this._colspanEff=0;this._rowspanEff=0;this._cells.forEach((function(e){e.row=0;e.col=0;e._colspanEff=0;e._rowspanEff=0}))};MultiRowCellGroup.prototype._calculate=function(){var e=this;this._clearCalculations();this._colspanEff=this.colspan;this._rowspanEff=this.rowspan;this._cells.forEach((function(t){e._colspanEff=Math.max(e._colspanEff,t.colspan);t._colspanEff=t.colspan;t._rowspanEff=t.rowspan}));var t=0,o=0;this._cells.forEach((function(r,n){for(;!e._cellFits(r,n,t,o);)0==(o=(o+1)%e._colspanEff)&&t++;r.row=t;r.col=o}));var r=1,n=1;this._cells.forEach((function(e){r=Math.max(r,e.row+e._rowspanEff);n=Math.max(n,e.col+e._colspanEff)}));this._rowspanEff=r;this._colspanEff=n};MultiRowCellGroup.prototype._cellFits=function(e,t,o,r){if(r>0&&r+e._colspanEff>this._colspanEff)return!1;for(var n=0;n<e._colspanEff;n++)if(this._slotTaken(o,r+n,t))return!1;this._colspanEff=Math.max(this._colspanEff,r+e._colspanEff-1);return!0};MultiRowCellGroup.prototype._slotTaken=function(e,t,o){void 0===o&&(o=this._cells.length);for(var r=0;r<o;r++){var n=this._cells[r];if(e>=n.row&&e<=n.row+n._rowspanEff-1&&t>=n.col&&t<=n.col+n._colspanEff-1)return!0}return!1};return MultiRowCellGroup}(MultiRowCell);export{MultiRowCellGroup};var MultiRow=function(e){__extends(MultiRow,e);function MultiRow(t,o){var r=e.call(this,t)||this;r._hdrLayoutDef=null;r._centerVert=!0;r._collapsedHeaders=!1;r._multiRowGroupHeaders=!1;r._rowHdrCnt=0;r.collapsedHeadersChanging=new Event;r.collapsedHeadersChanged=new Event;r._layoutDef=new MultiRowCellCollection;r._layout=new _MultiRowLayout(r,r._layoutDef,(function(){return r._onLayoutChanged()}));addClass(r.hostElement,"wj-multirow");var n=r.columnHeaders.hostElement.parentElement,l=createElement('<div class="wj-hdr-collapse"><span></span></div>');l.style.display="none";n.appendChild(l);r._btnCollapse=l;r._updateButtonGlyph();r.addEventListener(l,"mousedown",(function(e){switch(r.collapsedHeaders){case null:case!1:r._collapsedHeadersWasNull=null==r.collapsedHeaders;r.collapsedHeaders=!0;break;case!0:r.collapsedHeaders=!!r._collapsedHeadersWasNull&&null}e.preventDefault();r.focus()}),!0);var i=r.hostElement;r.addEventListener(i,"mousedown",(function(e){if(!r._mouseHdl._szRowCol){var t=r._layout?r._layout._bindingGroups:null,o=t&&t.length?t[0]:null;if(o&&o.isRowHeader){var n=r.hitTest(e);if(n.panel==r.columnHeaders&&n.col<r.columns.frozen){e.preventDefault();r.selectAll()}}}}),!0);["dragover","dragleave","dragdrop"].forEach((function(e){r.removeEventListener(i,e)}));r._edtHdl=new _MultiRowEditHandler(r);r._addHdl=new _MultiRowAddNewHandler(r);r.formatItem.addHandler(r._formatItem,r);r.autoGenerateColumns=!1;r.allowDragging=AllowDragging.None;r.mergeManager=new _MergeManager;r.initialize(o);return r}MultiRow.prototype._getProductInfo=function(){return"H87K,MultiRow"};Object.defineProperty(MultiRow.prototype,"layoutDefinition",{get:function(){return this._layoutDef},set:function(e){var t=this;this.finishEditing()||this.finishEditing(!0);this._layoutDef=asArray(e);if(this._layout){this._layout._dispose();this._layout=null}this._layout=new _MultiRowLayout(this,e,(function(){return t._onLayoutChanged()}));this._rowHdrCnt=0;if(this._layout)for(var o=this._layout._bindingGroups,r=0;r<o.length;r++){var n=o[r];if(!n.isRowHeader)break;this._rowHdrCnt=n._colstart+n._colspanEff;n.cells.forEach((function(e){e.isReadOnly=!0;!e.header||e.binding||e.cellTemplate||(e.cellTemplate=e.header);e.cssClass?e.cssClass.indexOf("wj-header")<0&&(e.cssClass+=" wj-header"):e.cssClass="wj-header"}))}this._rowHdrCnt&&(this.columns.frozen=this._rowHdrCnt);this._bindGrid(!0);this._rowHdrCnt&&this.selectionMode&&this.select(this.selection.row,this._rowHdrCnt)},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"recordViewRange",{get:function(){var e=Math.floor(this.viewRange.row/this.rowsPerItem),t=Math.ceil(this.viewRange.row2/this.rowsPerItem);return __assign({},this.viewRange,{row:e,row2:t,_row:e,_row2:t})},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"headerLayoutDefinition",{get:function(){return this._hdrLayoutDef},set:function(e){var t=this;this._hdrLayoutDef=asArray(e);if(this._hdrLayout){this._hdrLayout._dispose();this._hdrLayout=null}var o=null;e&&(o=new _MultiRowLayout(this,e,(function(){return t._onHeaderLayoutChanged()})));this._hdrLayout=o;this._bindGrid(!0)},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"rowsPerItem",{get:function(){return this._layout._rowsPerItem},enumerable:!0,configurable:!0});MultiRow.prototype.getBindingColumn=function(e,t,o){return this._getBindingColumn(e,t,e.columns[o])};MultiRow.prototype.getColumn=function(t,o){if(isString(t)){for(var r=o&&this._hdrLayout,n=(r?this._hdrLayout:this._layout)._bindingGroups,l=null,i=0;i<n.length&&!l;i++)l=n[i].getColumn(t);return!l&&r?this.getColumn(t,!1):l}return e.prototype.getColumn.call(this,t)};Object.defineProperty(MultiRow.prototype,"centerHeadersVertically",{get:function(){return this._centerVert},set:function(e){if(e!=this._centerVert){this._centerVert=asBoolean(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"collapsedHeaders",{get:function(){return this._collapsedHeaders},set:function(e){if(e!=this._collapsedHeaders){var t=new CancelEventArgs;if(this.onCollapsedHeadersChanging(t)){this._collapsedHeaders=asBoolean(e,!0);this._updateCollapsedHeaders();this._updateButtonGlyph();this.onCollapsedHeadersChanged(t)}}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"showHeaderCollapseButton",{get:function(){return""==this._btnCollapse.style.display},set:function(e){e!=this.showHeaderCollapseButton&&(this._btnCollapse.style.display=asBoolean(e)?"":"none")},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"multiRowGroupHeaders",{get:function(){return this._multiRowGroupHeaders},set:function(e){if(e!=this._multiRowGroupHeaders){this._multiRowGroupHeaders=asBoolean(e);this._bindGrid(!0)}},enumerable:!0,configurable:!0});MultiRow.prototype.onCollapsedHeadersChanging=function(e){this.collapsedHeadersChanging.raise(this,e);return!e.cancel};MultiRow.prototype.onCollapsedHeadersChanged=function(e){this.collapsedHeadersChanged.raise(this,e)};Object.defineProperty(MultiRow.prototype,"allowPinning",{get:function(){return!1},set:function(e){assert(!e,"MultiRow does not support pinning.")},enumerable:!0,configurable:!0});MultiRow.prototype.onSelectionChanging=function(t){var o=t._rng;if(o&&o.isValid&&this.selectionMode){var r=this._mouseHdl._htDown,n=this.rows,l=this.columns,i=this._rowHdrCnt;if(i){o.col=Math.max(o.col,i);o.col2=Math.max(o.col2,i)}if(r&&(r.panel==this.rowHeaders||r.panel==this.cells&&r.col<i)){var a=n[o.topRow],s=n[o.bottomRow];if(a&&null!=a.recordIndex){var u=a.index-a.recordIndex,c=s instanceof _MultiGroupRow&&!this._multiRowGroupHeaders?1:this.rowsPerItem,p=s.index-s.recordIndex+c-1,d=l.length-1,_=o.row!=o.topRow?new CellRange(p,0,u,d):new CellRange(u,0,p,d);o.row=_.row;o.row2=_.row2;o.col2=d;switch(this.selectionMode){case SelectionMode.Cell:o.row2=_.row;o.col2=_.col;break;case SelectionMode.Row:o.row2=_.row}}}}return e.prototype.onSelectionChanging.call(this,t)};MultiRow.prototype._createSelHdl=function(){return new _MultiRowSelectionHandler(this)};MultiRow.prototype._getDeleteColumnIndex=function(){return this._rowHdrCnt};MultiRow.prototype._getQuickAutoSize=function(){return isBoolean(this.quickAutoSize)?this.quickAutoSize:this.formatItem.handlerCount<=1&&null==this.itemFormatter};MultiRow.prototype._addBoundRow=function(e,t){for(var o=e[t],r=0;r<this.rowsPerItem;r++)this.rows.push(new _MultiRow(o,t,r))};MultiRow.prototype._addNode=function(e,t,o){this._addBoundRow(e,t)};MultiRow.prototype._addGroupRow=function(e){for(var t=this._multiRowGroupHeaders?this.rowsPerItem:1,o=0;o<t;o++)this.rows.push(new _MultiGroupRow(e,o))};MultiRow.prototype._bindColumns=function(){for(var e=this,t=this.columnHeaders.rows,o=this._layout,r=this._hdrLayout,n=(r?r._rowsPerItem:this.rowsPerItem)+1;t.length>n;)t.removeAt(t.length-1);for(;t.length<n;)t.push(new Row);this._updateCollapsedHeaders();this.columns.clear();if(o&&o._bindingGroups){var l="width,minWidth,maxWidth,binding,header,format,dataMap,name,aggregate,cellTemplate".split(",");o._bindingGroups.forEach((function(t){for(var _loop_1=function(o){if(0===t.cells.length)return"continue";for(var r=new Column,_loop_2=function(e){var n=t.cells[e];n.col==o&&l.forEach((function(e){null!=n[e]&&n[e]!=r[e]&&(r[e]=n[e])}))},n=0;n<t.cells.length;n++)_loop_2(n);e.columns.push(r)},o=0;o<t._colspanEff;o++)_loop_1(o)}))}};MultiRow.prototype._updateCollapsedHeaders=function(){var e=this.columnHeaders.rows,t=this.collapsedHeaders;e[0].visible=0!=t;for(var o=1;o<e.length;o++)e[o].visible=1!=t};MultiRow.prototype._updateColumnTypes=function(){e.prototype._updateColumnTypes.call(this);var t=this.collectionView;if(hasItems(t)){var o=t.items[0];this._layout&&this._layout._updateCellTypes(o);this._hdrLayout&&this._hdrLayout._updateCellTypes(o)}};MultiRow.prototype._getBindingColumn=function(e,t,o){if(o&&(e==this.cells||e==this.columnHeaders)){var r=e.cellType==CellType.ColumnHeader;r&&t--;o=this._getGroupByColumn(o.index,r).getBindingColumn(e,t,o.index)}return o};MultiRow.prototype._getBindingColumns=function(){var e=[];this._layout._bindingGroups.forEach((function(t){t._cols.forEach((function(t){e.indexOf(t)<0&&e.push(t)}))}));return e};MultiRow.prototype._getRowsPerItem=function(){return this.rowsPerItem};MultiRow.prototype._cvCollectionChanged=function(e,t){if(this.autoGenerateColumns&&0==this.columns.length)this._bindGrid(!0);else{var o=NotifyCollectionChangedAction;switch(t.action){case o.Change:this.invalidate();break;case o.Add:if(t.index==this.collectionView.items.length-1){for(var r=this.rows.length;r>0&&this.rows[r-1]instanceof _NewRowTemplate;)r--;for(var n=0;n<this.rowsPerItem;n++)this.rows.insert(r+n,new _MultiRow(t.item,t.index,n));return}assert(!1,"added item should be the last one.");break;default:this._bindGrid(!1)}}};MultiRow.prototype._getGroupByColumn=function(e,t){var o=null;t&&this._hdrLayout&&!this.collapsedHeaders&&(o=this._hdrLayout._getGroupByColumn(e));o||(o=this._layout._getGroupByColumn(e));assert(o instanceof MultiRowCellGroup,"Failed to get the group!");return o};MultiRow.prototype._onLayoutChanged=function(){this.layoutDefinition=this._layoutDef};MultiRow.prototype._onHeaderLayoutChanged=function(){this.headerLayoutDefinition=this._hdrLayoutDef};MultiRow.prototype._formatItem=function(e,t){var o=this.rowsPerItem,r=t.panel,n=r.cellType,l=r.rows[t.range.row],i=r.rows[t.range.row2],a=t.cell,s=CellType;n==s.ColumnHeader&&toggleClass(a,"wj-group-header",0==t.range.row);if(n==s.Cell||n==s.ColumnHeader){var u=this._getGroupByColumn(t.col,n==s.ColumnHeader);toggleClass(a,"wj-group-start",u._colstart==t.range.col);toggleClass(a,"wj-group-end",u._colstart+u._colspanEff-1==t.range.col2)}if(o>1&&(n==s.Cell||n==s.RowHeader)){var c=i instanceof _MultiRow||i instanceof _MultiRowNewRowTemplate;toggleClass(a,"wj-record-start",!!(l instanceof _MultiRow||l instanceof _MultiRowNewRowTemplate)&&0==l.recordIndex);toggleClass(a,"wj-record-end",!!c&&i.recordIndex==o-1)}var p=this.alternatingRowStep;if(p){var d=!1;if(l instanceof _MultiRow){d=l.dataIndex%(p+1)==0;1==p&&(d=!d)}toggleClass(a,"wj-alt",d)}if(this._centerVert&&!a.getAttribute("wj-state-measuring")){var _=t.range.rowSpan>1;if(_&&t.updateContent)if(0==a.childElementCount)a.innerHTML="<div>"+a.innerHTML+"</div>";else{var h=document.createElement("div"),f=document.createRange();f.selectNodeContents(a);f.surroundContents(h)}toggleClass(a,"wj-center-vert",_)}};MultiRow.prototype._updateButtonGlyph=function(){var e=this._btnCollapse.querySelector("span");e instanceof HTMLElement&&(e.className=this.collapsedHeaders?"wj-glyph-left":"wj-glyph-down-left")};MultiRow.prototype._getError=function(t,o,r,n){if(isFunction(this.itemValidator)&&t==this.rowHeaders){for(var l=[],i=0;i<this.rowsPerItem;i++)for(r=0;r<this.columns.length;r++){var a=this.itemValidator(o+i,r,n);if(a){var s=this.getMergedRange(this.cells,o+i,r);s&&(s.columnSpan>1&&s.col<r||s.rowSpan>1&&s.row<o+i)||l.push(a)}}if(l.length){var u=this.errorTip,c=!!u&&u.isContentHtml;return l.join(c?"<br/>":"\n")}}return e.prototype._getError.call(this,t,o,r,n)};MultiRow.prototype._getEmptyRequiredCell=function(e){if(e>=0){e-=this.rows[e].recordIndex;for(var t=0;t<this._getRowsPerItem();t++)for(var o=e+t,r=0;r<this.columns.length;r++){var n=this._getBindingColumn(this.cells,o,this.columns[r]),l=this.getCellData(o,r,!1);if(n.getIsRequired(this.rows[o])&&(""===l||null==l)){if(!n.isReadOnly)return new CellRange(o,r);console.warn("Incorrect data. Column "+r+" is at the same time  required, empty and read-only")}}}return null};return MultiRow}(FlexGrid);export{MultiRow};var _MergeManager=function(e){__extends(_MergeManager,e);function _MergeManager(){return null!==e&&e.apply(this,arguments)||this}_MergeManager.prototype.getMergedRange=function(e,t,o,r){void 0===r&&(r=!0);var n=e.grid;if(t<0||t>=e.rows.length||o<0||o>=e.columns.length)return null;switch(e.cellType){case CellType.Cell:case CellType.RowHeader:if(e.rows[t]instanceof GroupRow&&!n.multiRowGroupHeaders)return this._getGroupRowMergedRange(e,t,o,r,!1)}switch(e.cellType){case CellType.Cell:if(e.rows[t]instanceof GroupRow)return this._getGroupRowMergedRange(e,t,o,r,n.multiRowGroupHeaders);case CellType.ColumnHeader:var l=e.cellType==CellType.ColumnHeader,i=n._getGroupByColumn(o,l);assert(i instanceof MultiRowCellGroup,"Failed to get the group!");var a=l?i.getMergedRange(e,t-1,o):i.getMergedRange(e,t,o),s=e.columns.frozen;if(s&&a&&a.columnSpan>1&&a.col<s&&a.col2>=s){a=a.clone();o<s?a.col2=s-1:a.col=s}var u=e.rows.frozen;if(u&&a&&a.rowSpan>1&&e.cellType==CellType.Cell&&a.row<u&&a.row2>=u){a=a.clone();t<u?a.row2=u-1:a.row=u}assert(!a||a.contains(t,o),"Merged range must contain source cell");return a;case CellType.RowHeader:var c=n.rowsPerItem,p=t-e.rows[t].recordIndex,d=Math.min(p+c-1,e.rows.length-1);return new CellRange(p,0,d,e.columns.length-1);case CellType.TopLeft:var _=n.collapsedHeaders,h=e.rows.length-1,f=h>0?1:0;return new CellRange(0!=_?0:f,0,1!=_?h:f,e.columns.length-1)}return null};_MergeManager.prototype._getGroupRowMergedRange=function(t,o,r,n,l){void 0===n&&(n=!0);var i=t.grid,a=t.cellType,s=t.rows[o];if(i.showGroups&&!i.childItemsPath&&s instanceof _MultiGroupRow&&s.dataItem instanceof CollectionViewGroup&&a==CellType.Cell){return i._layout._getGroupHeaderMergedRange(t,o,r,l)}return e.prototype.getMergedRange.call(this,t,o,r,n)};return _MergeManager}(MergeManager);export{_MergeManager};var _MultiRowAddNewHandler=function(e){__extends(_MultiRowAddNewHandler,e);function _MultiRowAddNewHandler(t){t._addHdl._detach();return e.call(this,t)||this}_MultiRowAddNewHandler.prototype.updateNewRowTemplate=function(){for(var e=this._g.editableCollectionView,t=this._g,o=t.rows,r=e&&e.canAddNew&&t.allowAddNew&&!t.isReadOnly,n=-1,l=0;l<o.length;l+=t.rowsPerItem)if(o[l]instanceof _MultiRowNewRowTemplate){n=l;break}if(r&&n>-1&&(this._top&&n>0||!this._top&&0==n)){n=-1;this._removeNewRowTemplate()}if(r&&n<0)for(l=0;l<t.rowsPerItem;l++){var i=new _MultiRowNewRowTemplate(l);0==l&&(this._nrt=i);this._top?o.insert(l,i):o.push(i)}!r&&n>-1&&this._removeNewRowTemplate()};_MultiRowAddNewHandler.prototype._keydown=function(t){e.prototype._keydown.call(this,t);t.defaultPrevented||t.keyCode!=Key.Escape||this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._beginningEdit=function(t,o){e.prototype._beginningEdit.call(this,t,o);this._top&&this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._rowEditStarting=function(t,o){e.prototype._rowEditStarting.call(this,t,o);this._top&&this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._rowEditEnded=function(t,o){e.prototype._rowEditEnded.call(this,t,o);this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._copyNewDataItem=function(){if(this._top)for(var e=this._g,t=e.rows,o=0;o<e.rowsPerItem;o++)t[o]instanceof _NewRowTemplate&&(t[o].dataItem=this._nrt.dataItem)};_MultiRowAddNewHandler.prototype._removeNewRowTemplate=function(){for(var e=0,t=this._g.rows;e<t.length;e++)if(t[e]instanceof _NewRowTemplate){t.removeAt(e);e--}};return _MultiRowAddNewHandler}(_AddNewHandler);export{_MultiRowAddNewHandler};var _MultiRowNewRowTemplate=function(e){__extends(_MultiRowNewRowTemplate,e);function _MultiRowNewRowTemplate(t){var o=e.call(this)||this;o._idxRecord=t;return o}Object.defineProperty(_MultiRowNewRowTemplate.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});return _MultiRowNewRowTemplate}(_NewRowTemplate);export{_MultiRowNewRowTemplate};_registerModule("wijmo.grid.multirow",selfModule);