/*!
    *
    * Wijmo Library 5.20232.939
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t};Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_react_base_1=require("@grapecity/wijmo.react.base"),React=__importStar(require("react")),wjcCore=__importStar(require("@grapecity/wijmo")),wjcGrid=__importStar(require("@grapecity/wijmo.grid")),wjcInteropGrid=__importStar(require("@grapecity/wijmo.interop.grid"));exports.CellTemplateType=wjcInteropGrid.GridCellTemplateType;class FlexGrid extends wijmo_react_base_1.ComponentBase{constructor(e){super(e,wjcGrid.FlexGrid,{objectProps:["childItemsPath","mergeManager","itemsSource","virtualizationThreshold","columnGroups"]})}_createControl(){let e=super._createControl();new DirectiveCellFactory(this,e);return e}}exports.FlexGrid=FlexGrid;class FlexGridColumn extends wijmo_react_base_1.ComponentBase{constructor(e){super(e,wjcGrid.Column,{objectProps:["dataMap","cellTemplate","editor"]});this._parentProp="columns"}_initParent(){var e=this.parent.control;if(e.autoGenerateColumns){e.autoGenerateColumns=!1;e.columns.clear()}super._initParent()}}exports.FlexGridColumn=FlexGridColumn;class FlexGridColumnGroup extends wijmo_react_base_1.ComponentBase{constructor(e){super(e,wjcGrid.ColumnGroup,{objectProps:["dataMap","cellTemplate","editor"]});this._parentProp="columnGroups"}}exports.FlexGridColumnGroup=FlexGridColumnGroup;class DirectiveCellFactory extends wjcInteropGrid.DirectiveCellFactoryBase{constructor(e,t){super(t);this._renderedCells=[];this._isViewUpdated=!1;t.updatedView.addHandler(this._gridViewUpdated,this);e._beforeDidUpdate.addHandler(this._gridCmpBeforeDidUpdate,this);e._afterDidUpdate.addHandler(this._gridCmpAfterDidUpdate,this)}shouldInstantiate(e){let t=e.templateCache;return null==t||t.column!==e.column||t.templateContextProperty!==e.templateContextProperty||e.cell.firstChild!=t.rootElement}renderTemplate(e,t){let r=e.row,l=e.templateContext,i=e.cell;e.cellBindingsData=this.setBindingsData({},r,e.column,r.dataItem,e.cellValue,l.valuePaths);this._renderCell(i,e);if(t){this._addRenderedCell(i);let t=e.templateCache={column:e.column,rootElement:i.firstElementChild,templateContextProperty:e.templateContextProperty};i[e.templateContextProperty]=t}}disposeTemplate(e,t,r){if(t){wijmo_react_base_1.ComponentBase.selectiveDomUnmount(e);this._removeRenderedCell(e);super.disposeTemplate(e,t,r)}}clearCell(e){wijmo_react_base_1.ComponentBase.selectiveDomUnmount(e)}applyImmediately(e){}flushPendingEvents(e){}getEditorFocusFlag(){return!0}setEditorFocusFlag(e){}_renderCell(e,t){var r=t||e.__wjCellLastRenderedProp;if(r){let t=r&&r.templateContext.template,l=r.cellBindingsData.localVars;wijmo_react_base_1.ComponentBase.selectiveDomRender(React.createElement("div",{},t&&t(l)),e);e.__wjCellLastRenderedProp=r}}_addRenderedCell(e){let t=this._renderedCells;t.indexOf(e)<0&&t.push(e)}_removeRenderedCell(e){let t=this._renderedCells,r=t.indexOf(e);r>-1&&t.splice(r,1)}_reRenderCells(){this._renderedCells.forEach(e=>this._renderCell(e))}_gridCmpBeforeDidUpdate(){this._isViewUpdated=!1}_gridCmpAfterDidUpdate(){this._gridCmpRendered()}_gridCmpRendered(){setTimeout(()=>{this._isViewUpdated?this._isViewUpdated=!1:this._reRenderCells()},wjcCore.Control._REFRESH_INTERVAL)}_gridViewUpdated(){this._isViewUpdated=!0}checkHeight(e){"$__cellTemplGroupHeader"!==e.templateContextProperty&&(this._isCheckingHeight||setTimeout(()=>{if(this._isCheckingHeight)return;var t=e.panel.rows,r=e.row.index;let l=e.cell;const i=l.style.height;l.style.height="0";let o=l.scrollHeight>7?l.scrollHeight:t[r].renderHeight;l.style.height=i;if(e.cellStamp===l[wjcInteropGrid.DirectiveCellFactoryBase._cellStampProp]){var n=e.rng,a=n&&n.rowSpan||1,s=e.isEdit;null!=t.maxSize&&(o=Math.min(o,t.maxSize));if(r<t.length&&t[r].renderHeight<o-1||t[r].renderHeight>o+1&&!s&&e.panel.cellType===wjcGrid.CellType.Cell){const t=o/a;e.row.resizedManually||(e.row.height=t);if(s){let r=this._isFullEdit(),l=this.grid;this._backupHeight=e.row.height;e.row.height=t;this._cacheRow=e.row;this._isCheckingHeight=!0;l.refresh();l.startEditing(r);this._isCheckingHeight=!1;e.isImeInput?this._initImeEditInput(e.cell,e.templateContext):this._initEditInput(e.cell,e.templateContext,null);return}}else s&&(e.isImeInput?this._initImeEditInput(e.cell,e.templateContext):this._initEditInput(e.cell,e.templateContext,null))}},2))}}exports.DirectiveCellFactory=DirectiveCellFactory;class FlexGridCellTemplate extends React.Component{get cellOverflow(){return this.props.cellOverflow}get autoSizeRows(){let e=this.props.autoSizeRows;return null==e||e}get forceFullEdit(){let e=this.props.forceFullEdit;return null==e||e}get valuePaths(){return this.props.valuePaths}get template(){return this.props[FlexGridCellTemplate._CellRenderFuncProp]}componentDidMount(){let e=this.props[wijmo_react_base_1.ComponentBase._propsParent];e&&e._mountedCB(()=>{let t=this.ownerControl=e.control;if(t instanceof wjcGrid.FlexGrid)this.grid=t;else if(t instanceof wjcGrid.Column){this.column=t;let r,l=e;do{r=(l=l.props[wijmo_react_base_1.ComponentBase._propsParent])&&l.control}while(r&&!(r instanceof wjcGrid.FlexGrid));this.grid=r}this.template&&this._attachToControl()})}componentWillUnmount(){this._detachFromControl()}componentDidUpdate(e){let t=e[FlexGridCellTemplate._CellRenderFuncProp],r=this.template;t!=r&&(null==t?this._attachToControl():null==r&&this._detachFromControl())}render(){return null}_attachToControl(){let e=this.cellType=wjcCore.asEnum(this.props.cellType,exports.CellTemplateType),t=this.ownerControl;t[DirectiveCellFactory.getTemplContextProp(e)]=this;t instanceof wjcGrid.Column&&(e===exports.CellTemplateType.Cell||e===exports.CellTemplateType.ColumnHeader||e===exports.CellTemplateType.ColumnFooter)&&t._setFlag(wjcGrid.RowColFlags.HasTemplate,!0);this.grid.invalidate()}_detachFromControl(){if(null!=this.cellType){this.ownerControl[DirectiveCellFactory.getTemplContextProp(this.cellType)]=null;this.grid.invalidate()}}}FlexGridCellTemplate._CellRenderFuncProp="template";exports.FlexGridCellTemplate=FlexGridCellTemplate;