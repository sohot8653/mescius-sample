/*!
    *
    * Wijmo Library 5.20232.939
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

"use strict";var __importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t;return e};Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("@grapecity/wijmo"),wijmo_chart_1=require("@grapecity/wijmo.chart"),selfModule=__importStar(require("@grapecity/wijmo.chart.render"));class _CanvasRenderEngine{constructor(t,e=!1){this._strokeWidth=1;this._fontSize=null;this._fontFamily=null;this._cssPriority=!0;this._readOnly=!1;this._applyCanvasClip=function(t,e){var i=this._canvasRect[e];if(i){t.beginPath();t.rect(i.left,i.top,i.width,i.height);t.clip();t.closePath()}};this._applyCanvasStyles=function(t,e,i,s,n){var a,l,r,o=this._canvas.getContext("2d"),h=this.stroke,_=this.fill,g=this.strokeWidth;e&&void 0!==e.stroke&&(h=e.stroke);e&&void 0!==e.fill&&(_=this._getOpacityColor(e.fill,e["fill-opacity"]));if(t){l=window.getComputedStyle(t);r=t.getBBox()}if(n){if(l){o.fillStyle=l.fill;a=l.fontStyle+" "+l.fontWeight+" "+l.fontSize+" "+l.fontFamily;o.font=a}else if(this.fontSize){o.fillStyle=this.textFill;o.font=this.fontSize+" "+(this.fontFamily||"sans-serif")}else if(this._canvasDefaultFont){o.fillStyle=this._canvasDefaultFont.textFill;a=this._canvasDefaultFont.fontSize+" "+this._canvasDefaultFont.fontFamily;o.font=a;if(o.font.replace(/\"/g,"'")!==a.replace(/\"/g,"'")){a=this._canvasDefaultFont.fontSize+" "+(o.font.split(" ")[1]||"sans-serif");o.font=a}}}else{if(l){h=l.stroke&&"none"!==l.stroke?l.stroke:h;_=l.fill&&"none"!==l.fill?this._getOpacityColor(l.fill,l["fill-opacity"]):_;g=l.strokeWidth?l.strokeWidth:g}if("none"!==h&&null!=h){this._applyColor("strokeStyle",h,r);o.lineWidth=+g.replace(/px/g,"");o.stroke()}if(s&&null!=_&&"transparent"!==_&&"none"!==_){this._applyColor("fillStyle",_,r);o.fill()}}};this._element=t;this._canvas=document.createElement("canvas");this._svgEngine=new wijmo_chart_1._SvgRenderEngine(t);this._element.appendChild(this._canvas);this._applyCSSStyles=e}beginRender(){var t,e=this._svgEngine.element,i=this._element;if(this._applyCSSStyles){this._svgEngine.beginRender();i=e}this._element.appendChild(e);this._canvasRect={};t=window.getComputedStyle(i);this._canvasDefaultFont={fontSize:t.fontSize,fontFamily:t.fontFamily,textFill:t.color}}endRender(){this._applyCSSStyles&&this._svgEngine.endRender();this._svgEngine.element.parentNode.removeChild(this._svgEngine.element)}setViewportSize(t,e){var i=this._canvas;i.getContext("2d"),this.fill;this._applyCSSStyles&&this._svgEngine.setViewportSize(t,e);i.width=t;i.height=e}get element(){return this._canvas}get fill(){return this._fill}set fill(t){this._svgEngine.fill=t;this._fill=t}get fontSize(){return this._fontSize}set fontSize(t){this._svgEngine.fontSize=t;var e=null==t||isNaN(t)?t:t+"px";this._fontSize=e}get fontFamily(){return this._fontFamily}set fontFamily(t){this._svgEngine.fontFamily=t;this._fontFamily=t}get stroke(){return this._stroke}set stroke(t){this._svgEngine.stroke=t;this._stroke=t}get strokeWidth(){return this._strokeWidth}set strokeWidth(t){this._svgEngine.strokeWidth=t;this._strokeWidth=t}get textFill(){return this._textFill}set textFill(t){this._svgEngine.textFill=t;this._textFill=t}get cssPriority(){return this._cssPriority}set cssPriority(t){this._svgEngine.cssPriority=t;this._cssPriority=t}get readOnly(){return this._readOnly}set readOnly(t){this._readOnly=t}addClipRect(t,e){if(t&&e){this._applyCSSStyles&&this._svgEngine.addClipRect(t,e);this._canvasRect[e]=t.clone()}}drawEllipse(t,e,i,s,n,a){if(!this.readOnly){var l,r=this._canvas.getContext("2d");this._applyCSSStyles&&(l=this._svgEngine.drawEllipse(t,e,i,s,n,a));r.save();r.beginPath();if(r.ellipse)r.ellipse(t,e,i,s,0,0,2*Math.PI);else{r.translate(t,e);r.scale(1,s/i);r.translate(-t,-e);r.arc(t,e,i,0,2*Math.PI);r.scale(1,1)}this._applyCanvasStyles(l,a,n,!0);r.restore();return l}}drawRect(t,e,i,s,n,a,l){if(!this.readOnly){var r,o=this._canvas.getContext("2d");this._applyCSSStyles&&(r=this._svgEngine.drawRect(t,e,i,s,n,a,l));o.save();this._applyCanvasClip(o,l);o.beginPath();o.rect(t,e,i,s);this._applyCanvasStyles(r,a,n,!0);o.restore();return r}}drawLine(t,e,i,s,n,a){if(!this.readOnly){var l,r=this._canvas.getContext("2d");this._applyCSSStyles&&(l=this._svgEngine.drawLine(t,e,i,s,n,a));r.save();r.beginPath();r.moveTo(t,e);r.lineTo(i,s);this._applyCanvasStyles(l,a,n);r.restore();return l}}drawLines(t,e,i,s,n,a){if(t&&e&&0!==t.length&&0!==e.length&&!this.readOnly){var l,r,o=this._canvas.getContext("2d"),h=a||Math.min(t.length,e.length);this._applyCSSStyles&&(l=this._svgEngine.drawLines([0,1],[1,0],i,s,n));o.save();this._applyCanvasClip(o,n);o.beginPath();o.moveTo(t[0],e[0]);for(r=1;r<h;r++)o.lineTo(t[r],e[r]);this._applyCanvasStyles(l,s,i);o.restore();return l}}drawSplines(t,e,i,s,n,a){if(t&&e&&0!==t.length&&0!==e.length&&!this.readOnly){var l,r,o=this._canvas.getContext("2d"),h=new wijmo_chart_1._Spline(t,e,a).calculate(),_=h.xs,g=h.ys,p=Math.min(_.length,g.length);this._applyCSSStyles&&(l=this._svgEngine.drawSplines([0,1],[1,0],i,s,n));o.save();this._applyCanvasClip(o,n);o.beginPath();o.moveTo(_[0],g[0]);for(r=1;r<p;r++)o.lineTo(_[r],g[r]);this._applyCanvasStyles(l,s,i);o.restore();return l}}drawPolygon(t,e,i,s,n){if(t&&e&&0!==t.length&&0!==e.length&&!this.readOnly){var a,l,r=this._canvas.getContext("2d"),o=Math.min(t.length,e.length);this._applyCSSStyles&&(a=this._svgEngine.drawPolygon(t,e,i,s,n));r.save();this._applyCanvasClip(r,n);r.beginPath();r.moveTo(t[0],e[0]);for(l=1;l<o;l++)r.lineTo(t[l],e[l]);r.closePath();this._applyCanvasStyles(a,s,i,!0);r.restore();return a}}drawPieSegment(t,e,i,s,n,a,l,r){if(!this.readOnly){var o,h=this._canvas.getContext("2d"),_=s,g=s+n;this._applyCSSStyles&&(o=this._svgEngine.drawPieSegment(t,e,i,s,n,a,l,r));h.save();this._applyCanvasClip(h,r);h.beginPath();h.moveTo(t,e);h.arc(t,e,i,_,g,!1);h.lineTo(t,e);this._applyCanvasStyles(o,l,a,!0);h.restore();return o}}drawDonutSegment(t,e,i,s,n,a,l,r,o){if(!this.readOnly){var h,_,g,p=this._canvas.getContext("2d"),y=n,f=n+a;this._applyCSSStyles&&(h=this._svgEngine.drawDonutSegment(t,e,i,s,n,a,l,r,o));(_=new wijmo_1.Point(t,e)).x+=s*Math.cos(y);_.y+=s*Math.sin(y);(g=new wijmo_1.Point(t,e)).x+=s*Math.cos(f);g.y+=s*Math.sin(f);p.save();this._applyCanvasClip(p,o);p.beginPath();p.moveTo(_.x,_.y);p.arc(t,e,i,y,f,!1);p.lineTo(g.x,g.y);p.arc(t,e,s,f,y,!0);this._applyCanvasStyles(h,r,l,!0);p.restore();return h}}drawString(t,e,i,s){if(!this.readOnly){var n,a=this._canvas.getContext("2d");this._applyCSSStyles&&(n=this._svgEngine.drawString(t,e,i,s));a.save();a.textBaseline="bottom";this._applyCanvasStyles(n,s,i,!0,!0);a.fillText(t,e.x,e.y);a.restore();return n}}drawStringRotated(t,e,i,s,n,a){if(!this.readOnly){var l,r=this._canvas.getContext("2d");r.measureText(t);this._applyCSSStyles&&(l=this._svgEngine.drawStringRotated(t,e,i,s,n,a));r.save();r.textBaseline="bottom";r.translate(i.x,i.y);r.rotate(Math.PI/180*s);r.translate(-i.x,-i.y);this._applyCanvasStyles(l,a,n,!0,!0);r.fillText(t,e.x,e.y);r.restore();return l}}measureString(t,e,i,s){var n,a=a=this._canvas.getContext("2d");if(this._applyCSSStyles)return this._svgEngine.measureString(t,e,i,s);this._applyCanvasStyles(null,null,e,!0,!0);n=a.measureText(t).width;return new wijmo_1.Size(n,1.5*parseInt(a.font))}startGroup(t,e,i=!1){var s,n=this._canvas.getContext("2d");this._applyCSSStyles&&(s=this._svgEngine.startGroup(t,e,i));n.save();this._applyCanvasClip(n,e);return s}endGroup(){this._applyCSSStyles&&this._svgEngine.endGroup();this._canvas.getContext("2d").restore()}drawImage(t,e,i,s,n){if(!this.readOnly){var a,l=this._canvas.getContext("2d"),r=new Image;this._applyCSSStyles&&(a=this._svgEngine.drawImage(t,e,i,s,n));r.onload=function(){l.drawImage(r,e,i,s,n)};r.src=t;return a}}_getOpacityColor(t,e){var i=new wijmo_1.Color(t);if(t.indexOf("url")>-1)return this.fill;if(t.indexOf("-")>-1){this.fill=t;return t}null!=e&&1===i.a&&(i.a=isNaN(e)?1:Number(e));return i.toString()}_applyColor(t,e,i){let s=_GradientColorUtil.tryParse(e),n=this._canvas.getContext("2d");if(null!=s)if(wijmo_1.isString(s)||null==i)n[t]=s;else{let e;if(null!=s.x1)e=s.relative?n.createLinearGradient(i.x+s.x1*i.width,i.y+s.y1*i.height,i.x+s.x2*i.width,i.y+s.y2*i.height):n.createLinearGradient(s.x1,s.y1,s.x2,s.y2);else if(null!=s.r)if(s.relative){let t=i.x+s.cx*i.width,a=i.y+s.cy*i.height,l=s.r*i.width,r=s.r*i.height/l,o=i.x+(null==s.fx?s.cx:s.fx)*i.width,h=i.y+(null==s.fy?s.cy:s.fy)*i.height,_=(null==s.fr?0:s.fr)*i.width,g=(null==s.fr?0:s.fr)*i.height,p=Math.min(_,g);e=n.createRadialGradient(o,h/r,p,t,a/r,l);n.setTransform(1,0,0,r,0,0)}else e=n.createRadialGradient(null==s.fx?s.cx:s.fx,null==s.fy?s.cy:s.fy,s.fr||0,s.cx,s.cy,s.r);s.colors&&s.colors.length>0&&null!=e&&s.colors.forEach(t=>{let i=new wijmo_1.Color("#000000");null!=t.color&&(i=t.color);null!=t.opacity&&(i.a=t.opacity);e.addColorStop(t.offset,i.toString())});n[t]=e}}}exports._CanvasRenderEngine=_CanvasRenderEngine;class _GradientColorUtil{static tryParse(t){if(_GradientColorUtil.parsedColor[t])return _GradientColorUtil.parsedColor[t];if(null==t||-1===t.indexOf("-"))return t;var e,i=t.replace(/\s+/g,"").split(/\-/g),s=i[0][0],n=!1,a=i[0].match(/\(\S+\)/)[0].replace(/[\(\\)]/g,"").split(/\,/g);if("l"===s||"L"===s){e={x1:"0",y1:"0",x2:"0",y2:"0",colors:[]};"l"===s&&(n=!0);["x1","y1","x2","y2"].forEach((t,i)=>{null!=a[i]&&(e[t]=+a[i])})}else if("r"===s||"R"===s){e={cx:"0",cy:"0",r:"0",colors:[]};"r"===s&&(n=!0);["cx","cy","r","fx","fy","fr"].forEach((t,i)=>{null!=a[i]&&""!==a[i]&&(e[t]=+a[i])})}e.relative=n;_GradientColorUtil.parsedColor[t]=e;var l=i.length-1;i.forEach((t,i)=>{t.indexOf(")")>-1&&(t=t.match(/\)\S+/)[0].replace(")",""));var s=t.split(":"),n={color:new wijmo_1.Color("#000000")};null!=s[0]&&(n.color=wijmo_1.Color.fromString(s[0]));null!=s[1]?n.offset=+s[1]:n.offset=i/l;null!=s[2]&&(n.opacity=+s[2]);e.colors.push(n)});return e}}_GradientColorUtil.parsedColor={};if(wijmo_chart_1.FlexChartBase&&wijmo_chart_1.FlexChartBase.prototype&&wijmo_chart_1.FlexChartBase.prototype._exportToImage&&wijmo_1.isIE()){const t=wijmo_chart_1.FlexChartBase.prototype._exportToImage;wijmo_chart_1.FlexChartBase.prototype._exportToImage=function(e,i){if("svg"===e){t.call(this,e,i);return}let s=this._bgColor(this.hostElement);this._isTransparent(s)&&(s="#ffffff");var n,a,l=new _CanvasRenderEngine(this.hostElement,!0);this._render(l,!1,s);n=(a=l.element).toDataURL("image/"+e);a.parentNode.removeChild(a);i.call(null,n);a=null;l=null}}wijmo_1._registerModule("wijmo.chart.render",selfModule);