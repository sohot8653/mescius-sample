/*!
    *
    * Wijmo Library 5.20232.939
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

import{WjBinding,WjContext,MetaFactory}from"@grapecity/wijmo.knockout.base";import*as mKo from"knockout";import*as wjcGrid from"@grapecity/wijmo.grid";var wjKo=mKo;export class wjFlexGrid extends WjBinding{_getControlConstructor(){return wjcGrid.FlexGrid}_createWijmoContext(){return new WjFlexGridContext(this)}_initialize(){super._initialize();MetaFactory.findProp("itemFormatter",this._metaData.props).updateControl=this._formatterPropHandler}_formatterPropHandler(e,t,r,l,o){if(l!==e._userFormatter){e._userFormatter=l;r.invalidate()}return!0}}wjFlexGrid._columnTemplateProp="_wjkoColumnTemplate";wjFlexGrid._cellClonedTemplateProp="__wjkoClonedTempl";wjFlexGrid._cellVMProp="__wjkoCellVM";wjFlexGrid._templColIdx="_wjkoTemplColIdx";wjFlexGrid._columnStyleBinding="wjStyle";wjFlexGrid._columnStyleProp="__wjkoStyle";export class WjFlexGridContext extends WjContext{constructor(){super(...arguments);this._wrapperFormatter=this._itemFormatter.bind(this)}_initControl(){super._initControl();this.control.itemFormatter=this._wrapperFormatter}_itemFormatter(e,t,r,l){var o=e.columns[r],i=o[wjFlexGrid._columnTemplateProp],n=o[wjFlexGrid._columnStyleProp];if((i||n)&&e.cellType==wjcGrid.CellType.Cell){var a=e.grid.editRange;if(a&&a.row===t&&a.col===r)return;if(e.rows[t]instanceof wjcGrid.GroupRow)return;var d=l[wjFlexGrid._cellVMProp],s=l[wjFlexGrid._cellClonedTemplateProp],m=e.rows[t].dataItem;if(d&&l[wjFlexGrid._templColIdx]!=r){l[wjFlexGrid._cellVMProp]=l[wjFlexGrid._cellClonedTemplateProp]=l[wjFlexGrid._templColIdx]=d=s=null;wjKo.cleanNode(l)}if(d){if(s){l.innerHTML="";l.appendChild(s)}d.$row(t);d.$col(r);d.$item()!=m?d.$item(m):d.$item.valueHasMutated()}else{d={$row:wjKo.observable(t),$col:wjKo.observable(r),$item:wjKo.observable(m)};var w=this.bindingContext.extend(d);if(i){l.innerHTML="<div>"+i+"</div>";var c=l.childNodes[0];l[wjFlexGrid._cellClonedTemplateProp]=c}else l.setAttribute("data-bind","style:"+n);l[wjFlexGrid._cellVMProp]=d;l[wjFlexGrid._templColIdx]=r;wjKo.applyBindings(w,l)}var j=l.scrollHeight;e.rows[t].renderHeight<j&&(e.rows.defaultSize=j)}else this._userFormatter&&this._userFormatter(e,t,r,l)}}export class wjFlexGridColumn extends WjBinding{_getControlConstructor(){return wjcGrid.Column}_createControl(e){return new wjcGrid.Column}_createWijmoContext(){return new WjFlexGridColumnContext(this)}}export class WjFlexGridColumnContext extends WjContext{_initControl(){var e=this.parentWjContext;if(e){var t=e.control;if(t.autoGenerateColumns){t.autoGenerateColumns=!1;t.columns.clear()}}super._initControl();var r=this.element.innerHTML.trim();this.control[wjFlexGrid._columnTemplateProp]=r;var l=this.allBindings.get(wjFlexGrid._columnStyleBinding);l&&(this.control[wjFlexGrid._columnStyleProp]=l.trim());(r||l)&&this.control._setFlag(wjcGrid.RowColFlags.HasTemplate,!0);this.element.innerHTML=""}}export class wjStyle{constructor(){this.preprocess=function(e,t,r){return wjStyle.quoteString(e)};this.init=function(){}}static quoteString(e){return null==e?e:"'"+e.replace(/'/g,"\\'")+"'"}static unquoteString(e){if(!e||e.length<2)return e;"'"===e.charAt(0)&&(e=e.substr(1,e.length-1));return e.replace(/\\\'/g,"'")}}wjKo.bindingHandlers[wjFlexGrid._columnStyleBinding]=new wjStyle;wjKo.bindingHandlers.wjFlexGrid=new wjFlexGrid;wjKo.bindingHandlers.wjFlexGridColumn=new wjFlexGridColumn;