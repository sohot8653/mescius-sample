/*!
    *
    * Wijmo Library 5.20232.939
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

import{createElement,format,evalTemplate,toggleClass,isFunction,isNumber,isArray,isBoolean,_registerModule}from"@grapecity/wijmo";import{DataMap,DataMapEditor}from"@grapecity/wijmo.grid";import*as selfModule from"@grapecity/wijmo.grid.cellmaker";export var SparklineType;!function(e){e[e.Line=0]="Line";e[e.Column=1]="Column";e[e.WinLoss=2]="WinLoss"}(SparklineType||(SparklineType={}));export var SparklineMarkers;!function(e){e[e.None=0]="None";e[e.First=1]="First";e[e.Last=2]="Last";e[e.High=4]="High";e[e.Low=8]="Low";e[e.Negative=16]="Negative"}(SparklineMarkers||(SparklineMarkers={}));var CellMaker=function(){function CellMaker(){}CellMaker.makeButton=function(e){return function(r,t){r.col.isReadOnly=!0;t.innerHTML="";var a=format('<button type="button" tabindex="-1">{txt}</button>',{txt:CellMaker._getOptionText(e,"text",r,r.text)});CellMaker._createElement(t,a,e,r);return null}};CellMaker.makeLink=function(e){return function(r,t){r.col.isReadOnly=!0;t.innerHTML="";var a=format('<a href="{href}" tabindex="-1">{txt}</a>',{txt:CellMaker._getOptionText(e,"text",r,r.text),href:CellMaker._getOptionText(e,"href",r,"#")});CellMaker._createElement(t,a,e,r);return null}};CellMaker.makeSparkline=function(e){return function(r,t){r.col.isReadOnly=!0;t.innerHTML="";var a=format("<div><svg><g>{spark}</g></svg></div>",{spark:CellMaker._getSparkline(r.value,e)});CellMaker._createElement(t,a,e,r);return null}};CellMaker.makeImage=function(e){return function(r,t){r.col.isReadOnly=!0;t.innerHTML="";var a=format('<img src="{src}"></div>',{src:CellMaker._getOptionText(e,"src",r,r.text)});CellMaker._createElement(t,a,e,r);return null}};CellMaker.makeRating=function(e){return function(r,t){var a=r.col,l=DataMapEditor,n=a.cssClass||"",i=CellMaker._WJC_CellMaker;if(!a.dataMap||a.dataMapEditor!=l.RadioButtons||n.indexOf(i)<0){for(var s=e?e.range:null,o=[],u=(s=s&&isArray(s)&&s.length>1&&s[1]>s[0]?s:[0,5])[0];u<=s[1];u++)o.push(u);a.dataMap=new DataMap(o);a.dataMapEditor=l.RadioButtons;n.indexOf(i)<0&&(a.cssClass=(n+" "+i).trim())}if(e&&e.label){var c=CellMaker._getOptionText(e,"label",r);t.setAttribute("aria-label",c.trim())}var k=t.querySelectorAll("label"),M=!!e&&e.showZeros,m=null==t.querySelector("input:checked");for(u=0;u<k.length;u++){var f=(c=k[u]).querySelector("input");toggleClass(c,"wj-chk-hidden","0"==f.value&&!M);toggleClass(c,"wj-chk-off",m);m=m||null!=c.querySelector("input:checked")}return null}};CellMaker._getOptionText=function(e,r,t,a){void 0===a&&(a="");var l=e?e[r]:"";return l?evalTemplate(l,t):a};CellMaker._createElement=function(e,r,t,a){var l=createElement(r,e),n=CellMaker._WJC_CellMaker;t&&t.cssClass&&(n+=" "+CellMaker._getOptionText(t,"cssClass",a));l.className=n.trim();if(t&&t.label){var i=CellMaker._getOptionText(t,"label",a);l.setAttribute("aria-label",i.trim());l instanceof HTMLImageElement&&l.setAttribute("alt",i.trim())}if(t&&t.attributes)for(var s in t.attributes)l.setAttribute(s,t.attributes[s]);t&&isFunction(t.click)&&(l.onclick=CellMaker._handleClick.bind({options:t,ctx:CellMaker._cloneContext(a)}));return l};CellMaker._cloneContext=function(e){if(isFunction(Object.assign))return Object.assign({},e);var r={};for(var t in e)r[t]=e[t];return r};CellMaker._handleClick=function(e){var r=this.options;if(isFunction(r.click)){e.preventDefault();var t=this.ctx;r.click(e,t)}};CellMaker._getSparkline=function(e,r){var t="",a=SparklineType,l=SparklineMarkers,n=null!=(r=r||{}).type?r.type:a.Line,i=null!=r.markers?r.markers:l.None,s=isNumber(r.baseValue)?r.baseValue:n==a.Line?null:0,o=isNumber(r.maxPoints)?r.maxPoints:null;if(e instanceof Array&&e.length>1){n==a.WinLoss&&(e=e.map((function(e){return isBoolean(e)?e?1:-1:isNumber(e)?e>0?1:e<0?-1:null:null})));var u=CellMaker._scaleValues(e,s,o),c=u.points,k=u.base,M=100/(c.length-(n==a.Line?1:0)),m=M>4?M-2:M,f=M-m;switch(n){case a.Column:case a.WinLoss:for(var p=0;p<c.length;p++){var g=c[p];null!=g&&(t+=format("<rect {cls}x={x}% y={y}% width={w}% height={h}% />",{x:(p*M+f).toFixed(2),y:Math.min(k,g),w:m.toFixed(2),h:Math.abs(k-g),cls:CellMaker._getMarkers(i,u,p)}))}break;case a.Line:for(p=0;p<c.length-1;p++){var C=c[p],x=c[p+1];null!=C&&null!=x&&(t+=format("<line x1={x1}% y1={y1}% x2={x2}% y2={y2}% />",{x1:Math.round(M*p),y1:C,x2:Math.round(M*(p+1)),y2:x}));var h=CellMaker._getMarkers(i,u,p),d='<circle {cls}cx={x}% cy={y}% r="3"/>';h&&(t+=format(d,{x:Math.round(M*p),y:C,cls:h}));p==c.length-2&&(h=CellMaker._getMarkers(i,u,p+1))&&(t+=format(d,{x:Math.round(M*(p+1)),y:x,cls:h}))}}null!=s&&n!=a.WinLoss&&(t+=format('<line class="x-axis" x1=0% y1={base}% x2=100% y2={base}% />',{base:u.base}))}return t};CellMaker._scaleValues=function(e,r,t){var a,l,n=[];t&&t>1&&e.length>t&&(e=e.slice(0,t));e.forEach((function(e){if(isNumber(e)){a=!isNumber(a)||e<a?e:a;l=!isNumber(l)||e>l?e:l}}));if(isNumber(a)&&isNumber(l)){if(null!=r){a=Math.min(a,r);l=Math.max(l,r)}else r=a>0?a:l<0?l:0;if(a==l){a--;l++}var i=l-a;e.forEach((function(e){n.push(isNumber(e)?100-Math.round((e-a)/i*100):null)}));r=100-Math.round((r-a)/i*100)}return{min:a,max:l,base:r,points:n,data:e}};CellMaker._getMarkers=function(e,r,t){var a="",l=SparklineMarkers;if(e){var n=r.data,i="wj-marker-";0!=(e&l.First)&&0==t&&(a+=i+"first ");0!=(e&l.Last)&&t==n.length-1&&(a+=i+"last ");0!=(e&l.High)&&n[t]==r.max&&(a+=i+"high ");0!=(e&l.Low)&&n[t]==r.min&&(a+=i+"low ");0!=(e&l.Negative)&&n[t]<0&&(a+=i+"negative ")}return a?'class="wj-marker '+a.trim()+'"':""};CellMaker._WJC_CellMaker="wj-cell-maker";return CellMaker}();export{CellMaker};_registerModule("wijmo.grid.cellmaker",selfModule);